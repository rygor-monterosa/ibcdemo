/*!
 *	Copyright (c) Monterosa Productions Limited 2015
 */
/*!
 * Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 *
 **/
!function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function i(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var r=new this;t=!1;for(var s in n)r[s]="function"==typeof n[s]&&"function"==typeof o[s]&&e.test(n[s])?function(t,e){return function(){var n=this._super;this._super=o[t];var i=e.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return i.prototype=r,i.prototype.constructor=i,i.extend=arguments.callee,i}}(),/*!
 * Standalone Deferred
 * Copyright 2012 Otto Vehvil√§inen
 * Released under MIT license
 *
 * This is a standalone implementation of the wonderful jQuery.Deferred API.
 * The documentation here is only for quick reference, for complete api please
 * see the great work of the original project:
 *
 * http://api.jquery.com/category/deferred-object/
 **/
function(){var t,e,n,i,o=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};if(!Array.prototype.forEach)throw new Error("Deferred requires Array.forEach");i=this,n=function(e){return e instanceof Deferred||e instanceof t},e=function(t){var e;return t?(e=[],t.forEach(function(n){return n?"function"==typeof n?e.push(n):t.forEach(function(t){return"function"==typeof t?e.push(t):void 0}):void 0}),e):[]},t=function(){function t(t){this._deferred=t}return t.prototype._deferred=null,t.prototype.always=function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=this._deferred).always.apply(e,t),this},t.prototype.done=function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=this._deferred).done.apply(e,t),this},t.prototype.fail=function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=this._deferred).fail.apply(e,t),this},t.prototype.pipe=function(t,e){return this._deferred.pipe(t,e)},t.prototype.state=function(){return this._deferred.state()},t.prototype.then=function(t,e){return this._deferred.then(t,e),this},t}(),i.Deferred=function(){function s(t){this.then=r(this.then,this),this.resolveWith=r(this.resolveWith,this),this.resolve=r(this.resolve,this),this.rejectWith=r(this.rejectWith,this),this.reject=r(this.reject,this),this.promise=r(this.promise,this),this.progress=r(this.progress,this),this.pipe=r(this.pipe,this),this.notifyWith=r(this.notifyWith,this),this.notify=r(this.notify,this),this.fail=r(this.fail,this),this.done=r(this.done,this),this.always=r(this.always,this),this._state="pending","function"==typeof t&&t.call(this,this)}return s.prototype.always=function(){var t,n,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(n=e(t),"pending"===this._state?(this._alwaysCallbacks||(this._alwaysCallbacks=[]),(i=this._alwaysCallbacks).push.apply(i,n)):n.forEach(function(t){return t.apply(r._context,r._withArguments)}),this)},s.prototype.done=function(){var t,n,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(n=e(t),"resolved"===this._state?n.forEach(function(t){return t.apply(r._context,r._withArguments)}):"pending"===this._state&&(this._doneCallbacks||(this._doneCallbacks=[]),(i=this._doneCallbacks).push.apply(i,n)),this)},s.prototype.fail=function(){var t,n,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(n=e(t),"rejected"===this._state?n.forEach(function(t){return t.apply(r._context,r._withArguments)}):"pending"===this._state&&(this._failCallbacks||(this._failCallbacks=[]),(i=this._failCallbacks).push.apply(i,n)),this)},s.prototype.notify=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.notifyWith.apply(this,[i].concat(o.call(t))),this},s.prototype.notifyWith=function(){var t,e,n;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(null!=(n=this._progressCallbacks)&&n.forEach(function(n){return n.apply(e,t)}),this)},s.prototype.pipe=function(t,e){var i;return i=new s,this.done(function(){var e,r,s;return e=1<=arguments.length?o.call(arguments,0):[],null!=t?(r=t.apply(this,e),n(r)?r.done(function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=i.resolveWith).call.apply(e,[i,this].concat(o.call(t)))}).fail(function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=i.rejectWith).call.apply(e,[i,this].concat(o.call(t)))}):i.resolveWith.call(i,this,r)):(s=i.resolveWith).call.apply(s,[i,this].concat(o.call(e)))}),this.fail(function(){var t,r,s,a;return t=1<=arguments.length?o.call(arguments,0):[],null!=e?(r=e.apply(this,t),n(r)?r.done(function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=i.resolveWith).call.apply(e,[i,this].concat(o.call(t)))}).fail(function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],(e=i.rejectWith).call.apply(e,[i,this].concat(o.call(t)))}):i.rejectWith.call(i,this,r),(s=i.rejectWith).call.apply(s,[i,this].concat(o.call(t)))):(a=i.rejectWith).call.apply(a,[i,this].concat(o.call(t)))}),i.promise()},s.prototype.progress=function(){var t,n,i;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length||"pending"!==this._state?this:(n=e(t),this._progressCallbacks||(this._progressCallbacks=[]),(i=this._progressCallbacks).push.apply(i,n),this)},s.prototype.promise=function(){return this._promise||(this._promise=new t(this))},s.prototype.reject=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.rejectWith.apply(this,[i].concat(o.call(t))),this},s.prototype.rejectWith=function(){var t,e,n,i,r=this;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(this._state="rejected",this._withArguments=t,this._context=e,null!=(n=this._failCallbacks)&&n.forEach(function(e){return e.apply(r._context,t)}),null!=(i=this._alwaysCallbacks)&&i.forEach(function(e){return e.apply(r._context,t)}),this)},s.prototype.resolve=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.resolveWith.apply(this,[i].concat(o.call(t))),this},s.prototype.resolveWith=function(){var t,e,n,i,r=this;return e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(this._state="resolved",this._context=e,this._withArguments=t,null!=(n=this._doneCallbacks)&&n.forEach(function(e){return e.apply(r._context,t)}),null!=(i=this._alwaysCallbacks)&&i.forEach(function(e){return e.apply(r._context,t)}),this)},s.prototype.state=function(){return this._state},s.prototype.then=function(t,e,n){return this.done(t),this.fail(e),this.progress(n),this},s}(),i.Deferred.when=function(){var t,e,n,i;return n=1<=arguments.length?o.call(arguments,0):[],0===n.length?(new Deferred).resolve().promise():1===n.length?n[0].promise():(e=new Deferred,i=0,t=[],n.forEach(function(r,s){return r.done(function(){var r;return r=1<=arguments.length?o.call(arguments,0):[],i+=1,t[s]=r,i===n.length?e.resolve.apply(e,t):void 0}).fail(function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],e.rejectWith.apply(e,[this].concat(o.call(t)))})}),e.promise())},function(){var t,e;return t=window.Zepto,t&&!t.Deferred?(t.Deferred=function(){return new Deferred},e=t.ajax,t.ajax=function(t){var n,i;return i=new Deferred,n=function(t,e){return function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],"function"==typeof t&&t.apply(null,n),e.apply(null,n)}},t.success=n(t.success,i.resolve),t.error=n(t.error,i.reject),e(t),i.promise()}):void 0}()}.call(this),/*!
 * asEvented v0.4.3 - an event emitter mixin which provides the observer pattern to JavaScript object.
 *
 * Copyright 2012, Michal Kuklis
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
window.asEvented=function(){function t(t,e,n){var i,o,r=this.events=this.events||{},s=t.split(/\s+/),a=s.length;for(e.__context=n||this,i=0;a>i;i++)r[o=s[i]]=r[o]||[],r[o].push(e);return this}function e(t,e,n){n=n||this;var i=function(){this.unbind(t,i),e.apply(n,a.call(arguments))};return this.bind(t,i,n),this}function n(t,e){var n,i,r,s,a,u;if(this.events){for(u=t.split(/\s+/),r=0,s=u.length;s>r;r++)if((i=u[r])in this.events!=!1)if(n=this.events[i],void 0===e)for(;n.length>0;)n.pop();else a=o(n,e),-1!==a&&n.splice(a,1);return this}}function i(t){var e,n,i,o=this.events;if(o&&t in o!=!1){for(e=a.call(arguments,1),n=o[t].length-1;n>=0;n--)i=o[t][n],i.apply(i.__context||this,e);return this}}function o(t,e){var n,i;if(s&&t.indexOf===s)return t.indexOf(e);for(n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1}var r=Array.prototype,s=r.indexOf,a=r.slice;return function(){return this.bind=this.on=t,this.unbind=this.off=this.removeListener=n,this.trigger=this.emit=i,this.one=this.once=e,this}}(),/*!
 * JSONP Core Plugin 2.4.0 (2012-08-21)
 *
 * https://github.com/jaubourg/jquery-jsonp
 *
 * Copyright (c) 2012 Julian Aubourg
 *
 * This document is licensed as free software under the terms of the
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
function(t){function e(){}function n(t){u=[t]}function i(t,e,n){return t&&t.apply(e.context||e,n)}function o(t){return/\?/.test(t)?"&":"?"}function r(t,e){t=t||{};for(var n in e)t[n]="object"==typeof e[n]?r(t[n],e[n]):e[n];return t}function s(t){for(var e=[],n=function(t,n){e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n)},i=0,o=t.length;o>i;i++)n(t[i].name,t[i].value);return e.join("&").replace(/%20/g,"+")}function a(a){function f(t){X++||($(),Q&&(A[W]={"s":[t]}),j&&(t=j.apply(b,[t])),i(k,b,[t,v,b]),i(Y,b,[b,v]))}function P(t){X++||($(),Q&&t!=y&&(A[W]=t),i(G,b,[b,t]),i(Y,b,[b,t]))}var b=r({},N);b=r(b,a);var D,I,M,U,F,x,k=b.success,G=b.error,Y=b.complete,j=b.dataFilter,H=b.callbackParameter,z=b.callback,B=b.cache,Q=b.pageCache,J=b.charset,W=b.url,q=b.data,K=b.timeout,X=0,$=e,I=new Deferred(function(t){t.done(k).fail(G),k=t.resolve,G=t.reject});return b.abort=function(){!X++&&$()},i(b.beforeSend,b,[b])===!1||X?b:(W=W||d,q=q?"string"==typeof q?q:s(q,b.traditional):d,W+=q?o(W)+q:d,H&&(W+=o(W)+encodeURIComponent(H)+"=?"),!B&&!Q&&(W+=o(W)+"_"+(new Date).getTime()+"="),W=W.replace(/=\?(&|$)/,"="+z+"$1"),Q&&(D=A[W])?D.s?f(D.s[0]):P(D):(t[z]=n,U=document.createElement(V),U.id=h+O++,J&&(U[c]=J),C&&C.version()<11.6?(F=document.createElement(V)).text="document.getElementById('"+U.id+"')."+p+"()":U[l]=l,R&&(U.htmlFor=U.id,U.event=E),U[g]=U[p]=U[_]=function(t){if(!U[L]||!/i/.test(U[L])){try{U[E]&&U[E]()}catch(e){}t=u,u=0,t?f(t[0]):P(w)}},U.src=W,$=function(){x&&clearTimeout(x),U[_]=U[g]=U[p]=null,m[T](U),F&&m[T](F)},m[S](U,M=m.firstChild),F&&m[S](F,M),x=K>0&&setTimeout(function(){P(y)},K)),I)}var u,l="async",c="charset",d="",w="error",S="insertBefore",h="_jqjsp",f="on",E=f+"click",p=f+w,g=f+"load",_=f+"readystatechange",L="readyState",T="removeChild",V="script",v="success",y="timeout",m=document.getElementsByTagName("head")[0]||document.documentElement,A={},O=0,N={"callback":h,"url":location.href},C=t.opera,R=function(){var t=document.createElement("div");return t.innerHTML="<!--[if IE]><i><![endif]-->",!!t.getElementsByTagName("i").length}();a.setup=function(t){t=r(N,t)},t.JSONP=a}(this),function(t,e,n){e[t]=n()}("$script",this,function(){function t(t,e){for(var n=0,i=t.length;i>n;++n)if(!e(t[n]))return w;return 1}function e(e,n){t(e,function(t){return!n(t)})}function n(r,s,w){function h(t){return t.call?t():u[t]}function f(){if(!--_){u[g]=1,p&&p();for(var n in c)t(n.split("|"),h)&&!e(c[n],h)&&(c[n]=[])}}r=r[S]?r:[r];var E=s&&s.call,p=E?s:w,g=E?r.join(""):s,_=r.length;return setTimeout(function(){e(r,function(t){return null===t?f():d[t]?(g&&(l[g]=1),2==d[t]&&f()):(d[t]=1,g&&(l[g]=1),i(!a.test(t)&&o?o+t+".js":t,f),void 0)})},0),n}function i(t,e){var n=r.createElement("script"),i=w;n.onload=n.onerror=n[p]=function(){n[f]&&!/^c|loade/.test(n[f])||i||(n.onload=n[p]=null,i=1,d[t]=2,e())},n.async=1,n.src=t,s.insertBefore(n,s.firstChild)}var o,r=document,s=r.getElementsByTagName("head")[0],a=/^https?:\/\//,u={},l={},c={},d={},w=!1,S="push",h="DOMContentLoaded",f="readyState",E="addEventListener",p="onreadystatechange";return!r[f]&&r[E]&&(r[E](h,function g(){r.removeEventListener(h,g,w),r[f]="complete"},w),r[f]="loading"),n.get=i,n.order=function(t,e,i){!function o(r){r=t.shift(),t.length?n(r,o):n(r,e,i)}()},n.path=function(t){o=t},n.ready=function(i,o,r){i=i[S]?i:[i];var s=[];return!e(i,function(t){u[t]||s[S](t)})&&t(i,function(t){return u[t]})?o():!function(t){c[t]=c[t]||[],c[t][S](o),r&&r(s)}(i.join("|")),n},n.done=function(t){n([null],t)},n}),window.LViS=function(t){var e,n,i,o=null,r=null,s=null;t.VERSION="1.44.0",t.ON_READY="ready",t.ON_EVENT="event",t.ON_ERROR="error",t.TIME_FORMAT_SECONDS=1,t.TIME_FORMAT_ARRAY=2,t.TIME_FORMAT_OBJECT=3,t.CHANNEL_POLL="p",t.CHANNEL_CONTROL="l",t.ConnectionManager=Enmasse,asEvented.call(t);var a=function(e){s=e,t.trigger(t.ON_EVENT,s),s.bind(n.ON_SUBSTATE,c),c()},u=function(){if(null!==s){var t=s.getChannels();for(var e in t)t.hasOwnProperty(e)&&Enmasse.send(t[e],window.LViS.ConnectionManager.SSCP_KLASS_UNSUB);s.unbind(n.ON_SUBSTATE,c),s.destroy(),s=null}},l=function(){var e,n=new Deferred,i={},o=t.getAssets();for(var r in o)if(o.hasOwnProperty(r))for(e=0;e<o[r].length;e++){var s=o[r][e],a=s.autoload;"undefined"!=typeof a&&("undefined"==typeof i[a]&&(i[a]=[]),i[a].push(s.data))}if("undefined"!=typeof i.js&&i.js.length>0?$script(i.js,n.resolve()):n.resolve(),"undefined"!=typeof i.css&&i.css.length>0)for(e=0;e<i.css.length;e++)if(document.createStyleSheet)document.createStyleSheet(i.css[e]);else{var u=document.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("media","all"),u.setAttribute("type","text/css"),u.setAttribute("href",i.css[e]),document.head.appendChild(u)}return Deferred.when(n)},c=function(){if(null!==s){var t=s.getSubstate();switch(t){case n.STATE_ACTIVE:d();break;case n.STATE_PROLONGED:w();break;case n.STATE_FINISHED:S()}}},d=function(){var t=s.getChannels();i.setChannels(t);for(var e in t)t.hasOwnProperty(e)&&Enmasse.send(t[e],window.LViS.ConnectionManager.SSCP_KLASS_SUB)},w=function(){var t=s.getChannels();i.setChannels(t);for(var e in t)t.hasOwnProperty(e)&&Enmasse.send(t[e],window.LViS.ConnectionManager.SSCP_KLASS_SUB)},S=function(){var t=s.getChannels();for(var e in t)t.hasOwnProperty(e)&&Enmasse.send(t[e],window.LViS.ConnectionManager.SSCP_KLASS_UNSUB)},h=function(){var t=arguments[0];switch(t){case Enmasse.STATE_CONNECTED:var e=arguments[1];window.LViS.Date.setTime(e),Enmasse.send(r,window.LViS.ConnectionManager.SSCP_KLASS_SUB),c()}},f=function(){Enmasse.connect()},E=function(){t.trigger(t.ON_ERROR)},p=function(){window.LViS.Analytics.embed();var e=l(),n=window.LViS.Project.loadAppSettings();Deferred.when(e,n).done(function(){t.trigger(t.ON_READY)}).fail(function(){t.trigger(t.ON_ERROR)})};return t.deprecate=function(t){console.warn("DEPRECATION: "+t)},t.getHost=function(){return"//"+o},t.getAssets=function(){return e.getAssets.apply(e,arguments)},t.getEvent=function(){return s},t.setEvent=function(e,n){n=n||function(){},s!==e&&e.loadHistory().always(function(){return e.isSubscribable()&&!e.isChannelsExist()?void t.trigger(t.ON_ERROR):(u(),a(e),void Deferred.when(e.ready).done(n))})},t.init=function(s){if(s=s||{},r=s.bChannel||null,o=s.host||null,null===r)throw"Bootstrap channel is not set";if(null===o)throw"Host is not defined";o=o.replace(/^(.*:)?(\/+)?/gi,""),n=window.LViS.Event,e=window.LViS.Listings,i=window.LViS.Factories,Enmasse.bind(Enmasse.ON_READY,f),Enmasse.bind(Enmasse.ON_ERROR,E),Enmasse.bind(Enmasse.ON_STATE,h),e.bind(e.ON_READY,p),e.init({"channel":r}),i.init(),Enmasse.init({"config":t.getHost()+"/config/enmasse.json","info":["lvis-"+t.VERSION]})},t}(window.LViS||{}),window.LViS=window.LViS||{},window.LViS.Analytics=function(){var t={};asEvented.call(t);var e="lvis",n=3e5,i=function(){t.track("send","event","system","heartbeat")};return t.getId=function(){return window.LViS.Project.get("tracking_id")},t.track=function(){if("undefined"!=typeof ga){var t=Array.prototype.slice.call(arguments);t[0]=e+"."+t[0],ga.apply(ga,t)}},t.embed=function(){var o=t.getId();null!==o&&(!function(t,e,n,i,o,r,s){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,r=e.createElement(n),s=e.getElementsByTagName(n)[0],r.async=1,r.src=i,s.parentNode.insertBefore(r,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",o,"auto",{"name":e}),ga(e+".send","pageview"),setInterval(i,n))},t}(),window.LViS=window.LViS||{},window.LViS.ConnectionAdaptor=function(){var t={};asEvented.call(t);var e=1e3;t.ON_MESSAGE=Enmasse.ON_MESSAGE;var n=0,i=[],o=null,r=function(t){i.push(t),s()},s=function(){clearTimeout(o);for(var n,r=0;r<i.length;)a(i[r])?(n=i.splice(r,1)[0],h(n),t.trigger(t.ON_MESSAGE,n)):r++;i.length>0&&(o=setTimeout(s,e))},a=function(t){var e=function(){switch(t.klass){case"create":return u;case"reveal":return l;case"revoke":return c;case"stop":return d;case"p":return w;default:return S}}();return e(t)},u=function(t){var e;try{e=JSON.parse(t.body[0])}catch(i){return!1}return e.published_at+n<=window.LViS.Date.now()},l=function(t){return parseInt(t.body[2])+n<=window.LViS.Date.now()},c=function(t){var e;try{e=JSON.parse(t.body[0])}catch(i){return!1}return e.sent_at+n<=window.LViS.Date.now()},d=function(t){return parseInt(t.body[1])+n<=window.LViS.Date.now()},w=function(t){return parseInt(t.body[1])+n<=window.LViS.Date.now()},S=function(){return!0},h=function(t){var e=function(){switch(t.klass){case"snapshot":return f;case"listings":return g;case"create":return L;case"reveal":return v;case"revoke":return y;case"stop":return V;case"p":return T;default:return m}}();e(t)},f=function(t){var e;try{e=JSON.parse(t.body[0])}catch(i){}e.published_at+=n,e.published_at_iso=new Date(1e3*e.published_at).toISOString();var o=function(){switch(e.type){case"prediction":return E;default:return p}}();o(e),t.body[0]=JSON.stringify(e)},E=function(t){var e=t.data;e.start_at+=n,e.start_at_iso=new Date(1e3*e.start_at).toISOString(),e.stop_at&&(e.stop_at+=n,e.stop_at_iso=new Date(1e3*e.stop_at).toISOString()),e.reveal_answer_at&&(e.reveal_answer_at+=n,e.reveal_answer_at_iso=new Date(1e3*e.reveal_answer_at).toISOString())},p=function(){},g=function(t){var e;try{e=JSON.parse(t.body[0])}catch(n){}window.LViS.Sync.setMaxDelay(e.project.audio_sync_max_delay),window.LViS.Sync.setDefaultDelay(e.project.audio_sync_default_delay);for(var i in e.events)e.events.hasOwnProperty(i)&&_(e.events[i]);t.body[0]=JSON.stringify(e)},_=function(t){t.start_at+=n,t.start_at_iso=new Date(1e3*t.start_at).toISOString(),t.end_at+=n,t.end_at_iso=new Date(1e3*t.end_at).toISOString(),t.__delay=n},L=function(t){var e;try{e=JSON.parse(t.body[0])}catch(i){}e.published_at+=n,e.published_at_iso=new Date(1e3*e.published_at).toISOString(),t.body[0]=JSON.stringify(e)},T=function(t){t.body[1]=parseInt(t.body[1])+n},V=function(t){t.body[1]=parseInt(t.body[1])+n},v=function(t){t.body[2]=parseInt(t.body[2])+n},y=function(t){var e;try{e=JSON.parse(t.body[0])}catch(i){}e.sent_at+=n,e.sent_at_iso=new Date(1e3*e.sent_at).toISOString(),t.body[0]=JSON.stringify(e)},m=function(){return 0};return t.adaptSnapshot=function(t){return f(t)},t.adaptEvent=function(t){return _(t)},t.setDelay=function(t){n=t},t.getDelay=function(){return n},Enmasse.bind(Enmasse.ON_MESSAGE,r),t}(),window.LViS=window.LViS||{},window.LViS.Control=function(t){t=t||{};var e=this,n=t.channel,i=function(t){if(t.channel==n)switch(t.klass){case window.LViS.Control.MSG_TYPE_CREATE:o(t);break;case window.LViS.Control.MSG_TYPE_REVOKE:r(t);break;case window.LViS.Control.MSG_TYPE_EOC:s(t)}},o=function(t){var n=JSON.parse(t.body[0]),i=window.LViS.Factories.get(n.type);if("undefined"!=typeof i){var o=i.get(n.id);if(!o){try{o=i.create(n)}catch(r){console.error(r)}Deferred.when(o.finalized).done(function(){e.trigger(window.LViS.Control.MSG_TYPE_CREATE,o)})}}},r=function(t){var n=JSON.parse(t.body[0]),i=window.LViS.Factories.get(n.type);if("undefined"!=typeof i){var o=i.get(n.id);o&&(i.revoke(n.id),e.trigger(window.LViS.Control.MSG_TYPE_REVOKE,o))}},s=function(){e.trigger(window.LViS.Control.MSG_TYPE_EOC)};e.destroy=function(){window.LViS.Factories.destroyInstances(),window.LViS.ConnectionAdaptor.unbind(window.LViS.ConnectionAdaptor.ON_MESSAGE,i)},window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,i)},asEvented.call(window.LViS.Control.prototype),window.LViS.Control.MSG_TYPE_CREATE="create",window.LViS.Control.MSG_TYPE_REVOKE="revoke",window.LViS.Control.MSG_TYPE_EOC="eoc",/*!
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
function(t){var e=function(t){return t.replace(/^\s+|\s+$/g,"")};t.cookie=function(t,n,i){if("undefined"==typeof n){var o=null;if(document.cookie&&""!==document.cookie)for(var r=document.cookie.split(";"),s=0;s<r.length;s++){var a=e(r[s]);if(a.substring(0,t.length+1)==t+"="){o=decodeURIComponent(a.substring(t.length+1));break}}return o}i=i||{},null===n&&(n="",i.expires=-1);var u="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var l;"number"==typeof i.expires?(l=new Date,l.setTime(l.getTime()+24*i.expires*60*60*1e3)):l=i.expires,u="; expires="+l.toUTCString()}var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",w=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(n),u,c,d,w].join("")}}(window.LViS||{}),window.LViS=window.LViS||{},window.LViS.Date=function(){var t={},e=.5,n=null,i=[],o=null,r=function(){return new Date/1e3},s=new Date/1e3,a=function(){clearTimeout(o);var t=r(),i=t-s;n+=i,s=t;var l=Math.floor(n)+1+e,c=1e3*(l-n);o=setTimeout(a,c),u()},u=function(){for(var t,e=[];i.length;)e.push(i.shift());for(i=[];void 0!==(t=e.shift());)t()};return t.setTime=function(t){n=Math.floor(t)+e,a()},t.now=function(){return Math.floor(n)},t.next=function(t){i.push(t)},t.setTime(r()),t}(),window.LViS=window.LViS||{},window.LViS.StorageLocalDriver=function(){var t={};return t.hasSupport=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},t.set=function(t,e){try{window.localStorage.setItem(t,e)}catch(n){n==QUOTA_EXCEEDED_ERR&&console.error("localstorage quota exceeded error")}},t.get=function(t){return window.localStorage.getItem(t)},t.remove=function(t){return window.localStorage.removeItem(t)},t}(),window.LViS.StorageCookieDriver=function(){var t={};return t.hasSupport=function(){var e="probe";try{t.set(e,e);var n=t.get(e);return t.remove(e),n===e}catch(i){return!1}},t.set=function(t,e,n){var i=[t,e];return"undefined"!=typeof n&&i.push({"expires":n}),window.LViS.cookie.apply(window.LViS.cookie,i)},t.get=function(t){return window.LViS.cookie(t)},t.remove=function(t){return window.LViS.cookie(t,null)},t}(),window.LViS.Storage=function(){for(var t=[window.LViS.StorageCookieDriver,window.LViS.StorageLocalDriver],e={},n=null,i=0;i<t.length;i++)if(t[i].hasSupport()){n=t[i];break}var o=function(){return null!==n};return e.set=function(t,e,i){return o()?n.set(t,e,i):void 0},e.get=function(t){return o()?n.get(t):void 0},e.remove=function(t){return o()?n.remove(t):void 0},e}(),window.LViS=window.LViS||{},window.LViS.Sync=function(){var t={},e=null,n=Number.POSITIVE_INFINITY,i=0;return t.setMaxDelay=function(t){t=parseInt(t),t>=0&&(n=t)},t.setDefaultDelay=function(t){t=parseInt(t),t>=0&&(i=t),i>n&&(i=n),null===e&&window.LViS.ConnectionAdaptor.setDelay(i)},t.setDelay=function(t){t=parseInt(t),e=0>t?0:t>n?n:t,window.LViS.ConnectionAdaptor.setDelay(e)},t.getMaxDelay=function(){return n},t.getDelay=function(){return window.LViS.ConnectionAdaptor.getDelay()},t}(),window.LViS=window.LViS||{},window.LViS.User=function(){var t={};t.ON_INTERACTION_SUBMIT="submit",t.ON_INTERACTION_REVEAL="reveal",asEvented.call(t);var e=t.bind,n=null,i=function(t){n=t,t.bind(window.LViS.Event.ON_ELEMENT_CREATE,l)},o=function(t){n=null,t.unbind(window.LViS.Event.ON_ELEMENT_CREATE,l)},r=function(t,e){var i=null,o=null;switch(t.constructor){case window.LViS.Poll:i="poll",o=n.getChannels(window.LViS.CHANNEL_POLL);break;case window.LViS.Quiz:i="quiz",o=n.getChannels(window.LViS.CHANNEL_POLL)}return{"session_id":window.LViS.ConnectionManager.getSessionId(),"element_id":t.getEnmasseId(),"element_type":i,"interaction_type":e,"option_id":t.getUserVote(),"channel_id":o}},s=function(t){null!==n&&o(n),i(t)},a=function(e){var n=r(e,"submit");t.trigger(t.ON_INTERACTION_SUBMIT,e,n)},u=function(e,n){if(n===window.LViS.Quiz.STATE_REVEALED){var i=e.getUserSubmission();if(null!==i){var o=i.isCorrect?"correct":"incorrect",s=r(e,o);t.trigger(t.ON_INTERACTION_REVEAL,e,s)}}},l=function(t){switch(t.constructor){case window.LViS.CombiPoll:case window.LViS.Powerbar:case window.LViS.Poll:t.bind(window.LViS.Poll.ON_VOTE,function(){a(t)});break;case window.LViS.Quiz:t.bind(window.LViS.Quiz.ON_VOTE,function(){a(t)}),t.bind(window.LViS.Quiz.ON_STATE_CHANGE,function(e){u(t,e)})}};return t.getSessionId=function(){return window.LViS.ConnectionManager.getSessionId()},t.signIn=function(t,e,n){return window.LViS.ConnectionManager.signIn(t,e,n)},t.bind=function(){var n=null;switch(arguments[0]){case t.ON_INTERACTION_SUBMIT:n="LViS.User.ON_INTERACTION_SUBMIT";break;case t.ON_INTERACTION_REVEAL:n="LViS.User.ON_INTERACTION_REVEAL"}null!==n&&window.LViS.deprecate("Event "+n+" has been deprecated. Please implement user votes storage in the application layer"),e.apply(t,arguments)},window.LViS.bind(window.LViS.ON_EVENT,s),t}(),window.LViS=window.LViS||{},window.LViS.Project=function(){var t={},e={},n={};return t.get=function(t){return"undefined"==typeof t?e:"undefined"!=typeof e[t]?e[t]:null},t.getSettings=function(t){return"undefined"==typeof t?n:"undefined"!=typeof n[t]?n[t]:null},t.getUUID=function(){return t.get("uuid")},t.setData=function(t){e=t||{}},t.getSkinUrl=function(){return t.get("app_skin")},t.loadAppSettings=function(){var e=t.get("app_settings"),i=new Deferred,o=function(t){n=t,i.resolve()},r=function(){i.reject()};return null!==e?i=JSONP({"url":e,"dataType":"jsonp","callback":"__lvis_app_settings_callback","callbackParameter":"__lvis_app_settings_callback","success":o,"error":r}):i.resolve(),i.promise()},t}(),window.LViS=window.LViS||{},window.LViS.Listings=function(){var t={},e=null,n=[],i={},o={},r=!1;t.ON_READY="ready",t.ON_UPDATE="update",t.MSG_CLASS="listings",asEvented.call(t);var s=function(s){if(s.channel==e)switch(s.klass){case t.MSG_CLASS:var a=JSON.parse(s.body[0]),l=r&&u(a);n=a.events,n.sort(function(t,e){return t.start_at<e.start_at?-1:t.start_at>e.start_at?1:0}),window.LViS.Project.setData(a.project),r||(i=a.assets);for(var c=0,d=n.length;d>c;c++){var w=n[c];o[w.id]&&o[w.id].setData(w)}l&&t.trigger(t.ON_UPDATE);break;case window.LViS.ConnectionManager.SSCP_KLASS_EOC:r||(r=!0,t.trigger(t.ON_READY))}},a=function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n].id===e)return t[n];return null},u=function(t){var e,i,o;for(e=0,i=t.events.length;i>e;e++)if(o=a(n,t.events[e].id),null===o||o.digest!=t.events[e].digest)return!0;for(e=0,i=n.length;i>e;e++)if(null===a(t.events,n[e].id))return!0;return!1};return t.get=function(t){if("undefined"!=typeof o[t])return o[t];var e=a(n,t),i=new window.LViS.Event(t);return e&&i.setData(e),o[t]=i,i},t.getCurrent=function(){for(var e=[],i=window.LViS.Date.now(),o=0,r=n.length;r>o;o++)n[o].start_at<i&&i<n[o].end_at&&e.push(t.get(n[o].id));return e.length?e:null},t.getNext=function(){var e,i,o=Number.POSITIVE_INFINITY,r=[],s=window.LViS.Date.now();for(e=0,i=n.length;i>e;e++)s<n[e].start_at&&n[e].start_at<o&&(o=n[e].start_at);if(o<Number.POSITIVE_INFINITY)for(e=0,i=n.length;i>e;e++)n[e].start_at==o&&r.push(t.get(n[e].id));return r.length?r:null},t.getList=function(){for(var t,e=[],i=0,o=n.length;o>i;i++)null!==(t=this.get(n[i].id))&&e.push(t);return e},t.getAssets=function(t){return"undefined"==typeof t?i:i[t]||null},t.init=function(t){t=t||{},e=t.channel||null,window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,s)},t}(),window.LViS=window.LViS||{},window.LViS.Event=function(t){t=t||null;var e=window.LViS.Event,n=window.LViS.Control,i=window.LViS.Factories,o=this,r=e.STATE_PENDING,s={},a=[],u=null,l=null;o.ready=new Deferred;var c=function(){d(),w(),u=setInterval(w,1e3)},d=function(){clearInterval(u)},w=function(){var t,n=window.LViS.Date.now(),i=o.get("end_at"),s=o.get("start_at"),a=o.get("__delay"),u=parseInt(window.LViS.Project.get("event_extra_time"),10)||0;!o.get("started")||s>n?t=e.STATE_UPCOMING:i>n?t=e.STATE_ACTIVE:i-a+u>n?t=e.STATE_PROLONGED:(t=e.STATE_FINISHED,d()),t!=r&&f(t)},S=function(){null===l&&(l=new n({"channel":o.getChannels(window.LViS.CHANNEL_CONTROL)}),l.bind(n.MSG_TYPE_CREATE,L),l.bind(n.MSG_TYPE_REVOKE,T),l.bind(n.MSG_TYPE_EOC,V))},h=function(){null!==l&&(l.unbind(n.MSG_TYPE_CREATE,L),l.unbind(n.MSG_TYPE_REVOKE,T),l.unbind(n.MSG_TYPE_EOC,V),l.destroy(),l=null)},f=function(t){switch(r=t){case e.STATE_FAILURE:case e.STATE_UPCOMING:case e.STATE_FINISHED:o.ready.resolve();break;case e.STATE_ACTIVE:case e.STATE_PROLONGED:S()}o.trigger(e.ON_STATE,o.getState()),o.trigger(e.ON_SUBSTATE,o.getSubstate())},E=function(t){for(var e=0,n=t.timeline.length;n>e;e++){var r=t.timeline[e],a=i.get(r.type),u={"channel":null,"klass":"snapshot","body":[JSON.stringify(r)]};window.LViS.ConnectionAdaptor.adaptSnapshot(u),r=JSON.parse(u.body[0]);try{var l=a.createSnapshot(r);L(l)}catch(d){console.error(d)}}o.isPending()&&(window.LViS.ConnectionAdaptor.adaptEvent(t.config),s=t.config,c())},p=function(t){for(var e=a.length;e--;)if(a[e].getId()===t.getId())return!0;return!1},g=function(t){var e=a.indexOf(t);e>-1&&a.splice(e,1)},_=function(t){if(!p(t)){for(var e=a.length-1;e>=0;e--){if(a[e].publishedAt<t.publishedAt)return void a.splice(e+1,0,t);if(a[e].publishedAt==t.publishedAt&&a[e].id<t.id)return void a.splice(e+1,0,t)}a.unshift(t)}},L=function(t){_(t),"resolved"==o.ready.state()&&o.trigger(e.ON_ELEMENT_CREATE,t)},T=function(t){g(t),o.trigger(e.ON_ELEMENT_REVOKE,t)},V=function(){o.ready.resolve()};this.get=function(t){return"undefined"==typeof t?s:"undefined"!=typeof s[t]?s[t]:null},this.getUUID=function(){return t},this.getChannels=function(t){var e=this.getUUID(),n=function(t){return t+"-"+e};if("undefined"==typeof t)return{"poll":n(window.LViS.CHANNEL_POLL),"control":n(window.LViS.CHANNEL_CONTROL)};if(t===window.LViS.CHANNEL_POLL||t===window.LViS.CHANNEL_CONTROL)return n(t);throw"Unknown channel type "+t},this.getImageUrl=function(){return this.get("image_url")},this.getName=function(){return this.get("name")},this.getStartAt=function(){return this.get("start_at")},this.getEndAt=function(){return this.get("end_at")},this.getState=function(){switch(r){case e.STATE_PROLONGED:return e.STATE_FINISHED;default:return r}},this.getSubstate=function(){return r},this.getCustomFields=function(t){var e=this.get("custom_fields");return"undefined"==typeof t?e:"undefined"!=typeof e[t]?e[t]:null},this.getCountdown=function(t){t=t||window.LViS.TIME_FORMAT_SECONDS;var e={"years":0,"months":0,"days":0,"hours":0,"minutes":0,"seconds":0},n=this.get("start_at")-window.LViS.Date.now();if(0>n&&(n=0),t==window.LViS.TIME_FORMAT_SECONDS)return n;var i,o,r=new Date(1e3*n),s={"years":"getUTCFullYear","months":"getUTCMonth","days":"getUTCDate","hours":"getUTCHours","minutes":"getUTCMinutes","seconds":"getUTCSeconds"};for(var a in e)if(e.hasOwnProperty(a)){switch(i=s[a],o=r[i](),i){case"getUTCDate":o--;break;case"getUTCFullYear":o-=1970}e[a]=o}switch(t){case window.LViS.TIME_FORMAT_OBJECT:return e;case window.LViS.TIME_FORMAT_ARRAY:var u=e;return[u.seconds,u.minutes,u.hours,u.days,u.months,u.years];default:return null}},this.getHistory=function(){return a},this.getLastFromHistory=function(){var t=null;return a.length>0&&(t=a[a.length-1]),t},this.setData=function(t){s&&s.digest?s.digest!=t.digest&&(s=t||{},w(),o.trigger(e.ON_UPDATE)):(s=t||{},c())},this.isPending=function(){return r===e.STATE_PENDING},this.isChannelsExist=function(){var t=this.getChannels();return"undefined"!=typeof t&&"undefined"!=typeof t.control&&"undefined"!=typeof t.poll},this.isSubscribable=function(){return r===e.STATE_ACTIVE||r===e.STATE_PROLONGED||r===e.STATE_FINISHED},this.loadHistory=function(){var n=new Deferred,i=parseInt(window.LViS.Project.get("history_ignore"),10)||60,r=this.get("__delay"),s=this.get("start_at"),a=s-r+i,u=function(t){try{E(t)}catch(e){throw e}},l=function(){o.isPending()&&f(e.STATE_FAILURE)};return this.isPending()||window.LViS.Date.now()>a?n=JSONP({"url":window.LViS.getHost()+"/events/"+t.substr(0,2)+"/"+t+"/history.jsonp","dataType":"jsonp","callback":"__lvis_history_callback","callbackParameter":"__lvis_history_callback","success":u,"error":l}):n.resolve(),n},this.destroy=function(){d(),h()}},asEvented.call(window.LViS.Event.prototype),window.LViS.Event.ON_UPDATE="update",window.LViS.Event.ON_STATE="state",window.LViS.Event.ON_SUBSTATE="substate",window.LViS.Event.ON_ELEMENT_CREATE="create",window.LViS.Event.ON_ELEMENT_REVOKE="revoke",window.LViS.Event.STATE_FAILURE="failure",window.LViS.Event.STATE_PENDING="pending",window.LViS.Event.STATE_UPCOMING="upcoming",window.LViS.Event.STATE_ACTIVE="active",window.LViS.Event.STATE_PROLONGED="prolonged",window.LViS.Event.STATE_FINISHED="finished",window.LViS.Fadeable={"getFade":function(){return this.fade},"init":function(t){this._super.apply(this,arguments),this.fade=t.data.fade}},window.LViS.Revealable={"hasResults":function(){return null!==this.results&&this.isResultsRevealed()},"isResultsRevealed":function(){switch(this.revealResultsMode){case window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE:return this.hasUserVoted()||this.isClosed();case window.LViS.Revealable.REVEAL_RESULTS_ON_CLOSE:return this.isClosed();case window.LViS.Revealable.REVEAL_RESULTS_ON_EVENT_END:case window.LViS.Revealable.REVEAL_RESULTS_MANUALLY:return null!==this.results;case window.LViS.Revealable.REVEAL_RESULTS_NEVER:return!1}},"init":function(t){this._super.apply(this,arguments),this.revealResultsMode=t.data.reveal_results_mode||window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE}},window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE="vote",window.LViS.Revealable.REVEAL_RESULTS_ON_CLOSE="close",window.LViS.Revealable.REVEAL_RESULTS_ON_EVENT_END="event_end",window.LViS.Revealable.REVEAL_RESULTS_MANUALLY="manual",window.LViS.Revealable.REVEAL_RESULTS_NEVER="never",window.LViS.Entity=Class.extend({"getId":function(){return this.id},"getEnmasseId":function(){return this.enmasseId},"getPublishedAt":function(){return this.publishedAt},"finalize":function(){this.finalized.resolve()},"destroy":function(){},"init":function(t){asEvented.call(this),t=t||{},this.id=t.id-0||0,this.enmasseId=t.data.id-0||0,this.publishedAt=t.published_at-0||0,this.finalized=new Deferred}}),window.LViS.Frame=window.LViS.Entity.extend({"getEnmasseId":function(){return this.enmasseId},"getDuration":function(){return this.duration},"getDurationLeft":function(){return this.durationLeft},"getType":function(){return this.type},"getContentType":function(){return null===this.contentType?this.type:this.contentType},"getCustomFields":function(t){return"undefined"==typeof t?this.customFields:"undefined"!=typeof this.customFields[t]?this.customFields[t]:null},"getUserSubmission":function(){return window.LViS.deprecate("Elements' getUserSubmission() method has been deprecated. Please implement user votes storage in the application layer"),null},"hasFixedDuration":function(){return this.fixed},"setDuration":function(t){this.duration=parseInt(t,10)},"setDurationLeft":function(t){this.durationLeft=parseInt(t,10)},"abort":function(){this.aborted=!0,this.setDurationLeft(0)},"updateDurationLeft":function(){if(!this.aborted){var t=this,e=this.publishedAt+this.duration,n=window.LViS.Date.now(),i=e-n;this.setDurationLeft(i),this.durationLeft>0?window.LViS.Date.next(function(){t.updateDurationLeft()}):this.durationLeft=0}},"init":function(t){this._super(t),t=t||{},this.aborted=!1,this.enmasseId=t.data.id,this.duration=t.duration-0||0,this.durationLeft=0,this.type=t.type,this.fixed=t.fixed,this.contentType=t.content_type||null,this.customFields=t.custom_fields||{},this.fixed&&this.updateDurationLeft()}}),window.LViS.Poll=window.LViS.Frame.extend({"getQuestion":function(){return this.question},"getOptions":function(){return this.options},"getResults":function(){return this.results},"getState":function(){return this.state},"getUserVote":function(){return this.votedFor},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"optionId":this.votedFor}},"hasUserVoted":function(){return null!==this.getUserVote()},"hasResults":function(){return null!==this.results},"vote":function(t){this.votedFor=t,this.storeVote(),this.triggerVote()},"setState":function(t){void 0!==t&&t!=this.state&&(this.state=t,this.trigger(window.LViS.Poll.ON_STATE_CHANGE,t))},"setResults":function(t){JSON.stringify(t)!=JSON.stringify(this.rawResults)&&(this.rawResults=t,this.populateResults(t),this.hasResults()&&this.trigger(window.LViS.Poll.ON_RESULTS))},"isStarted":function(){return this.state===window.LViS.Poll.STATE_STARTED},"isClosed":function(){return this.state===window.LViS.Poll.STATE_CLOSED},"stop":function(){this.abort(),this.setState(window.LViS.Poll.STATE_CLOSED)},"populateResults":function(t){t=t||[],this.results=[];for(var e=0,n=this.options.length;n>e;e++)this.results[e]={"votes":t[e]||0,"percent":0};this.calculatePercentage(this.results)},"calculatePercentage":function(t){var e,n,i=0,o=0,r=0;for(e=t.length;e--;)i+=parseInt(t[e].votes,10);for(e=0,n=t.length;n>e;e++)r=t[e].votes/i*100||0,t[e]={"votes":t[e].votes,"percent":Math.round(o+r)-Math.round(o)},o+=r;return t},"storeVote":function(){var t="frame_"+this.getId(),e=JSON.stringify(this.votedFor),n=new Date(1e3*(window.LViS.Date.now()+window.LViS.Poll.EXPIRE));window.LViS.Storage.set(t,e,n)},"recoverVote":function(){var t="frame_"+this.getId();try{this.votedFor=JSON.parse(window.LViS.Storage.get(t))}catch(e){console.error("Unable to recover option user voted for",e)}},"triggerVote":function(){this.trigger(window.LViS.Poll.ON_VOTE,this.votedFor)},"init":function(t){if(this._super(t),this.question=t.data.question,this.options=t.data.options,this.rawResults=null,this.results=null,this.votedFor=null,this.state=t.data.state||window.LViS.Poll.STATE_STARTED,this.recoverVote(),t.data.hasOwnProperty("results")){var e=t.data.results.map(function(t){return t.votes});this.setResults(e)}}}),window.LViS.Poll.TYPE="rpoll",window.LViS.Poll.EXPIRE=604800,window.LViS.Poll.STATE_STARTED="started",window.LViS.Poll.STATE_CLOSED="stopped",window.LViS.Poll.ON_VOTE="voted",window.LViS.Poll.ON_RESULTS="results",window.LViS.Poll.ON_STATE_CHANGE="state",window.LViS.Regular=window.LViS.Poll.extend(window.LViS.Revealable).extend({"getQualifyingHashtags":function(){return this.qualifying_hashtags},"init":function(t){this._super.apply(this,arguments),this.qualifying_hashtags=t.data.qualifying_hashtags}}),window.LViS.Regular.TYPE="rpoll",window.LViS.Regular.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Regular.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Regular.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Regular.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Regular.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.CombiPoll=window.LViS.Poll.extend(window.LViS.Revealable).extend({"getQuestion":function(t){return"undefined"==typeof t?this.question:this.question[t]},"getOptions":function(t){return"undefined"==typeof t?this.options:this.options[t]},"getResults":function(t){return 0===t?this.getFirstQuestionResult():this.results},"getFirstQuestionResult":function(){var t,e,n,i,o=[];for(t=0,n=this.results.length;n>t;t++)for(e=0,i=this.results[t].length;i>e;e++)"undefined"==typeof o[e]&&(o[e]={"votes":0,"percent":0}),o[e].votes+=this.results[t][e].votes;return this.calculatePercentage(o),o},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:this.votedFor},"vote":function(t,e){null===this.votedFor&&(this.votedFor=[]),this.votedFor[t]=e,this.storeVote(),this.triggerVote()},"hasUserVoted":function(t){return"undefined"==typeof t?this.hasUserVoted(0)&&this.hasUserVoted(1):null===this.votedFor?!1:"undefined"!=typeof this.votedFor[t]},"setEmptyResults":function(){var t=function(e,n){"undefined"==typeof n&&(n=e.length-1);for(var i=[],o=0,r=e[n].length+n;r>o;o++)i[o]=0===n?{"votes":0,"percent":0}:t(e,n-1);return i};this.results=t(this.options)},"populateResults":function(t){var e=this;this.setEmptyResults();var n=0,i=function(e){for(var o=0;o<e.length;o++)e[o].constructor===Array?i(e[o]):(e[o].votes=t[n]?t[n]:0,n++)},o=function(t){var n,i;if(t[0].constructor!==Array)e.calculatePercentage(t);else for(n=0,i=t.length;i>n;n++)o(t[n])};i(this.results),o(this.results)},"init":function(t){t.data.hasOwnProperty("results")&&(t.data.results=t.data.results.reduce(function(t,e){return t.concat(e)})),this._super(t)}}),window.LViS.CombiPoll.TYPE="cpoll",window.LViS.CombiPoll.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.CombiPoll.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.CombiPoll.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.CombiPoll.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.CombiPoll.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Powerbar=window.LViS.Poll.extend(window.LViS.Fadeable).extend({"setResults":function(t){for(var e={"time":window.LViS.Date.now(),"volume":0,"average":0,"responses":0},n=0,i=9;i>=n;n++)"undefined"!=typeof t[n]&&(e.volume+=t[n]*(n+1),e.responses+=t[n]);0!==e.responses&&(e.average=Math.round(e.volume/e.responses)),this.results.push(e),this.trigger(window.LViS.Powerbar.ON_RESULTS,e)},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"strength":this.votedFor}},"hasResults":function(){return this.results.length>0},"init":function(){this._super.apply(this,arguments),this.options=this.options.map(function(t,e){return{"text":"Strength "+(e+1)}}),this.results=[]}}),window.LViS.Powerbar.TYPE="powerbar",window.LViS.Powerbar.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Powerbar.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Powerbar.ON_VOLUME_UPDATE="volume",window.LViS.Powerbar.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Powerbar.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Powerbar.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Diametric=window.LViS.Poll.extend({"getUserVote":function(){return null===this.votedFor?null:Math.floor(this.votedFor/window.LViS.Diametric.MAX_STRENGTH)},"getUserVoteStrength":function(){return null===this.votedFor?null:this.votedFor%window.LViS.Diametric.MAX_STRENGTH+1},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"optionId":this.getUserVote(),"strength":this.getUserVoteStrength()}},"setResults":function(t){for(var e=window.LViS.Diametric.MAX_STRENGTH,n=[0,0],i=0;e>i;i++)t[i]&&(n[0]+=(i+1)*t[i]),t[i+e]&&(n[1]+=(i+1)*t[i+e]);this._super(n)},"vote":function(t,e){var n=window.LViS.Diametric.MIN_STRENGTH,i=window.LViS.Diametric.MAX_STRENGTH;if("undefined"==typeof t)return console.warn("Vote option is not set");if("undefined"==typeof e)return console.warn("Vote strength is not set");if(n>e)return console.warn("Can't vote for the option %s with strength %s that is less than minimum allowed strength %s",t,e,n);if(e>i)return console.warn("Can't vote for the option %s with strength %s that is more than maximum allowed strength %s",t,e,i);if(0>t||t>this.options.length-1)return console.warn("Can't vote for inexistent option with idx %s",t);var o=t*i+e-1;this._super(o)},"isResultsRevealed":function(){return!0}}),window.LViS.Diametric.MIN_STRENGTH=1,window.LViS.Diametric.MAX_STRENGTH=5,window.LViS.Diametric.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Diametric.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Swing=window.LViS.Diametric.extend({}),window.LViS.Swing.TYPE="dpoll",window.LViS.Swing.STATE_STARTED=window.LViS.Diametric.STATE_STARTED,window.LViS.Swing.STATE_CLOSED=window.LViS.Diametric.STATE_CLOSED,window.LViS.Emoting=window.LViS.Diametric.extend(window.LViS.Fadeable).extend({}),window.LViS.Emoting.TYPE="emo",window.LViS.Emoting.STATE_STARTED=window.LViS.Diametric.STATE_STARTED,window.LViS.Emoting.STATE_CLOSED=window.LViS.Diametric.STATE_CLOSED,window.LViS.Quiz=window.LViS.Poll.extend(window.LViS.Revealable).extend({"isClosed":function(){return this.isStopped()||this.isRevealed()},"isStopped":function(){return this.state===window.LViS.Quiz.STATE_STOPPED},"isRevealed":function(){return this.state===window.LViS.Quiz.STATE_REVEALED},"reveal":function(t){this.correctOption=t,this.setState(window.LViS.Quiz.STATE_REVEALED)},"stop":function(){this.abort(),this.setState(window.LViS.Quiz.STATE_STOPPED)},"getCorrectOption":function(){return this.correctOption},"getUserSubmission":function(){this._super.apply(this,arguments);var t={};return null===this.votedFor?null:(t.optionId=this.votedFor,null!==this.correctOption&&(t.isCorrect=this.votedFor==this.correctOption),t)},"init":function(t){this._super.apply(this,arguments),this.correctOption=t.data.hasOwnProperty("correct_option")?t.data.correct_option-1:null}}),window.LViS.Quiz.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Quiz.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Quiz.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Quiz.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Quiz.STATE_STOPPED=window.LViS.Poll.STATE_CLOSED,window.LViS.Quiz.STATE_REVEALED="revealed",window.LViS.Trivia=window.LViS.Quiz.extend({}),window.LViS.Trivia.TYPE="trivia",window.LViS.Trivia.STATE_STARTED=window.LViS.Quiz.STATE_STARTED,window.LViS.Trivia.STATE_STOPPED=window.LViS.Quiz.STATE_STOPPED,window.LViS.Trivia.STATE_REVEALED=window.LViS.Quiz.STATE_REVEALED,window.LViS.Trivia.ON_VOTE=window.LViS.Quiz.ON_VOTE,window.LViS.Trivia.ON_STATE_CHANGE=window.LViS.Quiz.ON_STATE_CHANGE,window.LViS.Trivia.ON_RESULTS=window.LViS.Quiz.ON_RESULTS,window.LViS.Prediction=window.LViS.Quiz.extend({}),window.LViS.Prediction.TYPE="prediction",window.LViS.Prediction.STATE_STARTED=window.LViS.Quiz.STATE_STARTED,window.LViS.Prediction.STATE_STOPPED=window.LViS.Quiz.STATE_STOPPED,window.LViS.Prediction.STATE_REVEALED=window.LViS.Quiz.STATE_REVEALED,window.LViS.Prediction.ON_VOTE=window.LViS.Quiz.ON_VOTE,window.LViS.Prediction.ON_STATE_CHANGE=window.LViS.Quiz.ON_STATE_CHANGE,window.LViS.Prediction.ON_RESULTS=window.LViS.Quiz.ON_RESULTS,window.LViS.Data=window.LViS.Frame.extend({"getState":function(){return this.state},"setState":function(t){t!=this.state&&(this.state=t,this.trigger(window.LViS.Data.ON_STATE_CHANGE,t))},"updateDurationLeft":function(){this._super(),this.setState(this.durationLeft>0?window.LViS.Data.STATE_STARTED:window.LViS.Data.STATE_CLOSED)},"init":function(t){this._super(t),this.state=null}}),window.LViS.Data.TYPE="data",window.LViS.Data.STATE_STARTED=1,window.LViS.Data.STATE_CLOSED=2,window.LViS.Data.ON_STATE_CHANGE="state",window.LViS=window.LViS||{},window.LViS.Curation=window.LViS.Entity.extend({"getText":function(){return this.text},"getSender":function(){return this.sender},"getSenderName":function(){return this.senderName},"getSenderPicure":function(){return this.senderPicture},"getSource":function(){return this.source},"init":function(t){this._super(t),this.text=t.data.text,this.sender=t.data.sender,this.senderName=t.data.sender_name,this.senderPicture=t.data.sender_picture,this.source=t.data.source}}),window.LViS.Curation.TYPE="curation",window.LViS.Curation.SOURCE_TWITTER="twitter",window.LViS.BaseFactory=Class.extend({"get":function(t){return this.instances[t]||!1},"create":function(){},"createSnapshot":function(){},"revoke":function(t){this.instances.hasOwnProperty(t)&&delete this.instances[t]},"destroyInstances":function(){for(var t in this.instances)this.instances.hasOwnProperty(t)&&(this.instances[t].destroy(),delete this.instances[t])},"init":function(){asEvented.call(this),this.instances={}}}),window.LViS.FrameFactory=window.LViS.BaseFactory.extend({"getByEnmasseId":function(t){for(var e in this.instances)if(this.instances[e].getEnmasseId()==t)return this.instances[e];return!1},"setMessages":function(){}}),window.LViS.PollFactory=window.LViS.FrameFactory.extend({"messages":[],"vote":function(t,e){var n=this.getByEnmasseId(t),i=[t,e+1];window.LViS.ConnectionManager.send(n._channel,"v",i)},"processMessages":function(){for(var t,e=0;e<this.messages.length;){t=this.messages[e];var n=this.getByEnmasseId(t.body[0]);if(n)switch(this.instances[n.getId()]._channel=t.channel,this.messages.splice(e,1),t.klass){case window.LViS.PollFactory.MSG_CLASS_POLL:this.processPollMessage(n,t);break;case window.LViS.PollFactory.MSG_CLASS_FB:this.processFeedbackMessage(n,t);break;case window.LViS.PollFactory.MSG_CLASS_STOP:this.processStopMessage(n,t);break;case window.LViS.PollFactory.MSG_CLASS_REVEAL:this.processRevealMessage(n,t)}else e++}},"processPollMessage":function(t){t.finalize()},"processFeedbackMessage":function(t,e){var n,i,o=e.body[1].split(":"),r="fin"===e.body[2],s=[];if(o.length>1)for(var a=0,u=o.length/2;u>a;a++)n=+o[2*a]-1,i=+o[2*a+1],s[n]=i;(s.length>0||r)&&t.setResults(s)},"processStopMessage":function(t){t.stop()},"processRevealMessage":function(t,e){t.reveal(e.body[1]-1)},"create":function(t){this._super(t);var e=this.getConstructorByType(t.type),n=new e(t);return this.instances[t.id]=n,this.processMessages(),n.bind(window.LViS.Poll.ON_VOTE,this.handleVote.bind(this,n)),n},"createSnapshot":function(t){this._super(t);var e=this.getConstructorByType(t.type),n=new e(t);return this.instances[t.id]=n,n.finalize(),n},"setMessage":function(t){-1!==window.LViS.PollFactory.MSG_CLASSES.indexOf(t.klass)&&(this.messages.push(t),this.processMessages())},"getConstructorByType":function(t){switch(t){case window.LViS.CombiPoll.TYPE:return window.LViS.CombiPoll;case window.LViS.Powerbar.TYPE:return window.LViS.Powerbar;case window.LViS.Prediction.TYPE:return window.LViS.Prediction;case window.LViS.Trivia.TYPE:return window.LViS.Trivia;case window.LViS.Swing.TYPE:return window.LViS.Swing;case window.LViS.Emoting.TYPE:return window.LViS.Emoting;case window.LViS.Regular.TYPE:return window.LViS.Regular}},"handleVote":function(t,e){var n=0;switch(t.getType()){case window.LViS.CombiPoll.TYPE:for(var i=t.getOptions(),o=1,r=0,s=e.length;s>r;r++)n+=o*(e[r]+1),o*=i[r].length;n-=1;break;default:n=e}this.vote(t.getEnmasseId(),n)},"init":function(){this._super();for(var t=[window.LViS.Regular.TYPE,window.LViS.CombiPoll.TYPE,window.LViS.Powerbar.TYPE,window.LViS.Swing.TYPE,window.LViS.Emoting.TYPE,window.LViS.Prediction.TYPE,window.LViS.Trivia.TYPE],e=t.length;e--;)window.LViS.Factories.register(t[e],this)}}),window.LViS.PollFactory.MSG_CLASS_POLL="p",window.LViS.PollFactory.MSG_CLASS_FB="fb",window.LViS.PollFactory.MSG_CLASS_STOP="stop",window.LViS.PollFactory.MSG_CLASS_REVEAL="reveal",window.LViS.PollFactory.MSG_CLASSES=[window.LViS.PollFactory.MSG_CLASS_POLL,window.LViS.PollFactory.MSG_CLASS_FB,window.LViS.PollFactory.MSG_CLASS_STOP,window.LViS.PollFactory.MSG_CLASS_REVEAL],window.LViS.DataFactory=window.LViS.FrameFactory.extend({"create":function(t){this._super(t);var e=new window.LViS.Data(t);return e.finalize(),this.instances[t.id]=e,e},"createSnapshot":function(t){return this._super(t),this.create(t)},"init":function(){this._super(),window.LViS.Factories.register(window.LViS.Data.TYPE,this)}}),window.LViS.CurationFactory=window.LViS.BaseFactory.extend({"create":function(t){this._super(t);var e=new window.LViS.Curation(t);return this.instances[t.id]=e,e},"createSnapshot":function(t){return this._super(t),this.create(t)},"init":function(){this._super(),window.LViS.Factories.register(window.LViS.Curation.TYPE,this)}}),window.LViS=window.LViS||{},window.LViS.Factories=function(){var t={},e={},n=[],i={};t.items={};var o=function(t){var e;return null!==(e=r(t.channel))&&e.setMessage(t),null},r=function(t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]==t)return i[n]||null;return null};return t.destroyInstances=function(){for(var t=n.length;t--;)n[t].destroyInstances()},t.setChannels=function(t){e=t},t.register=function(t,e){"undefined"==typeof this.items[t]&&(this.items[t]=e)},t.get=function(t){return this.items[t]},t.init=function(){for(var t,e=[{"obj":window.LViS.PollFactory,"channel":"poll"},{"obj":window.LViS.DataFactory,"channel":null},{"obj":window.LViS.CurationFactory,"channel":null}],r=e.length;r--;)t=new e[r].obj,n.push(t),null!==e[r].channel&&(i[e[r].channel]=t);window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,o)
},t}(),window.LViS=window.LViS||{},window.LViS.Demographics=function(){var t={};return t.ERROR_NO_EVENT=1,t.ERROR_SEGMENT=2,t.ERROR_COUNTER=3,t.addCounter=function(e,n,i,o,r){i="undefined"!=typeof i?i:null,o="undefined"!=typeof o?o:null,r="undefined"!=typeof r?r:null;var s=window.LViS.getEvent();if(!s)throw t.ERROR_NO_EVENT;if(e.constructor!==Array||!e.length||e.length%2!==0)throw t.ERROR_SEGMENT;if(n!==parseInt(n,10))throw t.ERROR_COUNTER;for(var a=[],u=[],l=0,c=e.length/2;c>l;l++)a.push(e[2*l]),u.push(e[2*l+1]);window.LViS.ConnectionManager.send(s.getChannels(window.LViS.CHANNEL_CONTROL),"avgcounter",[s.getUUID(),o,r,i,a.join(":"),u.join(":"),n])},t}();
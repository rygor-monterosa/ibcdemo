/*!
 *	Copyright (c) Monterosa Productions Limited 2015
 */
/*!
 * Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 *
 **/
!function(){var t=!1,n=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(e){function i(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var r=new this;t=!1;for(var s in e)r[s]="function"==typeof e[s]&&"function"==typeof o[s]&&n.test(e[s])?function(t,n){return function(){var e=this._super;this._super=o[t];var i=n.apply(this,arguments);return this._super=e,i}}(s,e[s]):e[s];return i.prototype=r,i.prototype.constructor=i,i.extend=arguments.callee,i}}(),/*!
 * Standalone Deferred
 * Copyright 2012 Otto Vehvil√§inen
 * Released under MIT license
 *
 * This is a standalone implementation of the wonderful jQuery.Deferred API.
 * The documentation here is only for quick reference, for complete api please
 * see the great work of the original project:
 *
 * http://api.jquery.com/category/deferred-object/
 **/
function(){var t,n,e,i,o=Array.prototype.slice,r=function(t,n){return function(){return t.apply(n,arguments)}};if(!Array.prototype.forEach)throw new Error("Deferred requires Array.forEach");i=this,e=function(n){return n instanceof Deferred||n instanceof t},n=function(t){var n;return t?(n=[],t.forEach(function(e){return e?"function"==typeof e?n.push(e):t.forEach(function(t){return"function"==typeof t?n.push(t):void 0}):void 0}),n):[]},t=function(){function t(t){this._deferred=t}return t.prototype._deferred=null,t.prototype.always=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=this._deferred).always.apply(n,t),this},t.prototype.done=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=this._deferred).done.apply(n,t),this},t.prototype.fail=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=this._deferred).fail.apply(n,t),this},t.prototype.pipe=function(t,n){return this._deferred.pipe(t,n)},t.prototype.state=function(){return this._deferred.state()},t.prototype.then=function(t,n){return this._deferred.then(t,n),this},t}(),i.Deferred=function(){function s(t){this.then=r(this.then,this),this.resolveWith=r(this.resolveWith,this),this.resolve=r(this.resolve,this),this.rejectWith=r(this.rejectWith,this),this.reject=r(this.reject,this),this.promise=r(this.promise,this),this.progress=r(this.progress,this),this.pipe=r(this.pipe,this),this.notifyWith=r(this.notifyWith,this),this.notify=r(this.notify,this),this.fail=r(this.fail,this),this.done=r(this.done,this),this.always=r(this.always,this),this._state="pending","function"==typeof t&&t.call(this,this)}return s.prototype.always=function(){var t,e,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(e=n(t),"pending"===this._state?(this._alwaysCallbacks||(this._alwaysCallbacks=[]),(i=this._alwaysCallbacks).push.apply(i,e)):e.forEach(function(t){return t.apply(r._context,r._withArguments)}),this)},s.prototype.done=function(){var t,e,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(e=n(t),"resolved"===this._state?e.forEach(function(t){return t.apply(r._context,r._withArguments)}):"pending"===this._state&&(this._doneCallbacks||(this._doneCallbacks=[]),(i=this._doneCallbacks).push.apply(i,e)),this)},s.prototype.fail=function(){var t,e,i,r=this;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length?this:(e=n(t),"rejected"===this._state?e.forEach(function(t){return t.apply(r._context,r._withArguments)}):"pending"===this._state&&(this._failCallbacks||(this._failCallbacks=[]),(i=this._failCallbacks).push.apply(i,e)),this)},s.prototype.notify=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.notifyWith.apply(this,[i].concat(o.call(t))),this},s.prototype.notifyWith=function(){var t,n,e;return n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(null!=(e=this._progressCallbacks)&&e.forEach(function(e){return e.apply(n,t)}),this)},s.prototype.pipe=function(t,n){var i;return i=new s,this.done(function(){var n,r,s;return n=1<=arguments.length?o.call(arguments,0):[],null!=t?(r=t.apply(this,n),e(r)?r.done(function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=i.resolveWith).call.apply(n,[i,this].concat(o.call(t)))}).fail(function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=i.rejectWith).call.apply(n,[i,this].concat(o.call(t)))}):i.resolveWith.call(i,this,r)):(s=i.resolveWith).call.apply(s,[i,this].concat(o.call(n)))}),this.fail(function(){var t,r,s,a;return t=1<=arguments.length?o.call(arguments,0):[],null!=n?(r=n.apply(this,t),e(r)?r.done(function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=i.resolveWith).call.apply(n,[i,this].concat(o.call(t)))}).fail(function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=i.rejectWith).call.apply(n,[i,this].concat(o.call(t)))}):i.rejectWith.call(i,this,r),(s=i.rejectWith).call.apply(s,[i,this].concat(o.call(t)))):(a=i.rejectWith).call.apply(a,[i,this].concat(o.call(t)))}),i.promise()},s.prototype.progress=function(){var t,e,i;return t=1<=arguments.length?o.call(arguments,0):[],0===t.length||"pending"!==this._state?this:(e=n(t),this._progressCallbacks||(this._progressCallbacks=[]),(i=this._progressCallbacks).push.apply(i,e),this)},s.prototype.promise=function(){return this._promise||(this._promise=new t(this))},s.prototype.reject=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.rejectWith.apply(this,[i].concat(o.call(t))),this},s.prototype.rejectWith=function(){var t,n,e,i,r=this;return n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(this._state="rejected",this._withArguments=t,this._context=n,null!=(e=this._failCallbacks)&&e.forEach(function(n){return n.apply(r._context,t)}),null!=(i=this._alwaysCallbacks)&&i.forEach(function(n){return n.apply(r._context,t)}),this)},s.prototype.resolve=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.resolveWith.apply(this,[i].concat(o.call(t))),this},s.prototype.resolveWith=function(){var t,n,e,i,r=this;return n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"pending"!==this._state?this:(this._state="resolved",this._context=n,this._withArguments=t,null!=(e=this._doneCallbacks)&&e.forEach(function(n){return n.apply(r._context,t)}),null!=(i=this._alwaysCallbacks)&&i.forEach(function(n){return n.apply(r._context,t)}),this)},s.prototype.state=function(){return this._state},s.prototype.then=function(t,n,e){return this.done(t),this.fail(n),this.progress(e),this},s}(),i.Deferred.when=function(){var t,n,e,i;return e=1<=arguments.length?o.call(arguments,0):[],0===e.length?(new Deferred).resolve().promise():1===e.length?e[0].promise():(n=new Deferred,i=0,t=[],e.forEach(function(r,s){return r.done(function(){var r;return r=1<=arguments.length?o.call(arguments,0):[],i+=1,t[s]=r,i===e.length?n.resolve.apply(n,t):void 0}).fail(function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],n.rejectWith.apply(n,[this].concat(o.call(t)))})}),n.promise())},function(){var t,n;return t=window.Zepto,t&&!t.Deferred?(t.Deferred=function(){return new Deferred},n=t.ajax,t.ajax=function(t){var e,i;return i=new Deferred,e=function(t,n){return function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],"function"==typeof t&&t.apply(null,e),n.apply(null,e)}},t.success=e(t.success,i.resolve),t.error=e(t.error,i.reject),n(t),i.promise()}):void 0}()}.call(this),/*!
 * asEvented v0.4.3 - an event emitter mixin which provides the observer pattern to JavaScript object.
 *
 * Copyright 2012, Michal Kuklis
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
window.asEvented=function(){function t(t,n,e){var i,o,r=this.events=this.events||{},s=t.split(/\s+/),a=s.length;for(n.__context=e||this,i=0;a>i;i++)r[o=s[i]]=r[o]||[],r[o].push(n);return this}function n(t,n,e){e=e||this;var i=function(){this.unbind(t,i),n.apply(e,a.call(arguments))};return this.bind(t,i,e),this}function e(t,n){var e,i,r,s,a,u;if(this.events){for(u=t.split(/\s+/),r=0,s=u.length;s>r;r++)if((i=u[r])in this.events!=!1)if(e=this.events[i],void 0===n)for(;e.length>0;)e.pop();else a=o(e,n),-1!==a&&e.splice(a,1);return this}}function i(t){var n,e,i,o=this.events;if(o&&t in o!=!1){for(n=a.call(arguments,1),e=o[t].length-1;e>=0;e--)i=o[t][e],i.apply(i.__context||this,n);return this}}function o(t,n){var e,i;if(s&&t.indexOf===s)return t.indexOf(n);for(e=0,i=t.length;i>e;e++)if(t[e]===n)return e;return-1}var r=Array.prototype,s=r.indexOf,a=r.slice;return function(){return this.bind=this.on=t,this.unbind=this.off=this.removeListener=e,this.trigger=this.emit=i,this.one=this.once=n,this}}(),/*!
 * JSONP Core Plugin 2.4.0 (2012-08-21)
 *
 * https://github.com/jaubourg/jquery-jsonp
 *
 * Copyright (c) 2012 Julian Aubourg
 *
 * This document is licensed as free software under the terms of the
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
function(t){function n(){}function e(t){u=[t]}function i(t,n,e){return t&&t.apply(n.context||n,e)}function o(t){return/\?/.test(t)?"&":"?"}function r(t,n){t=t||{};for(var e in n)t[e]="object"==typeof n[e]?r(t[e],n[e]):n[e];return t}function s(t){for(var n=[],e=function(t,e){n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)},i=0,o=t.length;o>i;i++)e(t[i].name,t[i].value);return n.join("&").replace(/%20/g,"+")}function a(a){function f(t){X++||($(),Q&&(A[W]={"s":[t]}),j&&(t=j.apply(b,[t])),i(x,b,[t,v,b]),i(Y,b,[b,v]))}function P(t){X++||($(),Q&&t!=y&&(A[W]=t),i(G,b,[b,t]),i(Y,b,[b,t]))}var b=r({},N);b=r(b,a);var D,I,M,U,F,k,x=b.success,G=b.error,Y=b.complete,j=b.dataFilter,H=b.callbackParameter,z=b.callback,B=b.cache,Q=b.pageCache,J=b.charset,W=b.url,q=b.data,K=b.timeout,X=0,$=n,I=new Deferred(function(t){t.done(x).fail(G),x=t.resolve,G=t.reject});return b.abort=function(){!X++&&$()},i(b.beforeSend,b,[b])===!1||X?b:(W=W||d,q=q?"string"==typeof q?q:s(q,b.traditional):d,W+=q?o(W)+q:d,H&&(W+=o(W)+encodeURIComponent(H)+"=?"),!B&&!Q&&(W+=o(W)+"_"+(new Date).getTime()+"="),W=W.replace(/=\?(&|$)/,"="+z+"$1"),Q&&(D=A[W])?D.s?f(D.s[0]):P(D):(t[z]=e,U=document.createElement(V),U.id=h+O++,J&&(U[c]=J),C&&C.version()<11.6?(F=document.createElement(V)).text="document.getElementById('"+U.id+"')."+p+"()":U[l]=l,R&&(U.htmlFor=U.id,U.event=E),U[g]=U[p]=U[_]=function(t){if(!U[L]||!/i/.test(U[L])){try{U[E]&&U[E]()}catch(n){}t=u,u=0,t?f(t[0]):P(w)}},U.src=W,$=function(){k&&clearTimeout(k),U[_]=U[g]=U[p]=null,m[T](U),F&&m[T](F)},m[S](U,M=m.firstChild),F&&m[S](F,M),k=K>0&&setTimeout(function(){P(y)},K)),I)}var u,l="async",c="charset",d="",w="error",S="insertBefore",h="_jqjsp",f="on",E=f+"click",p=f+w,g=f+"load",_=f+"readystatechange",L="readyState",T="removeChild",V="script",v="success",y="timeout",m=document.getElementsByTagName("head")[0]||document.documentElement,A={},O=0,N={"callback":h,"url":location.href},C=t.opera,R=function(){var t=document.createElement("div");return t.innerHTML="<!--[if IE]><i><![endif]-->",!!t.getElementsByTagName("i").length}();a.setup=function(t){t=r(N,t)},t.JSONP=a}(this),function(t,n,e){n[t]=e()}("$script",this,function(){function t(t,n){for(var e=0,i=t.length;i>e;++e)if(!n(t[e]))return w;return 1}function n(n,e){t(n,function(t){return!e(t)})}function e(r,s,w){function h(t){return t.call?t():u[t]}function f(){if(!--_){u[g]=1,p&&p();for(var e in c)t(e.split("|"),h)&&!n(c[e],h)&&(c[e]=[])}}r=r[S]?r:[r];var E=s&&s.call,p=E?s:w,g=E?r.join(""):s,_=r.length;return setTimeout(function(){n(r,function(t){return null===t?f():d[t]?(g&&(l[g]=1),2==d[t]&&f()):(d[t]=1,g&&(l[g]=1),i(!a.test(t)&&o?o+t+".js":t,f),void 0)})},0),e}function i(t,n){var e=r.createElement("script"),i=w;e.onload=e.onerror=e[p]=function(){e[f]&&!/^c|loade/.test(e[f])||i||(e.onload=e[p]=null,i=1,d[t]=2,n())},e.async=1,e.src=t,s.insertBefore(e,s.firstChild)}var o,r=document,s=r.getElementsByTagName("head")[0],a=/^https?:\/\//,u={},l={},c={},d={},w=!1,S="push",h="DOMContentLoaded",f="readyState",E="addEventListener",p="onreadystatechange";return!r[f]&&r[E]&&(r[E](h,function g(){r.removeEventListener(h,g,w),r[f]="complete"},w),r[f]="loading"),e.get=i,e.order=function(t,n,i){!function o(r){r=t.shift(),t.length?e(r,o):e(r,n,i)}()},e.path=function(t){o=t},e.ready=function(i,o,r){i=i[S]?i:[i];var s=[];return!n(i,function(t){u[t]||s[S](t)})&&t(i,function(t){return u[t]})?o():!function(t){c[t]=c[t]||[],c[t][S](o),r&&r(s)}(i.join("|")),e},e.done=function(t){e([null],t)},e}),window.LViS=function(t){var n,e,i,o=null,r=null,s=null,a=null;t.VERSION="1.44.0-tracking.4",t.ON_READY="ready",t.ON_EVENT="event",t.ON_ERROR="error",t.TIME_FORMAT_SECONDS=1,t.TIME_FORMAT_ARRAY=2,t.TIME_FORMAT_OBJECT=3,t.CHANNEL_POLL="p",t.CHANNEL_CONTROL="l",t.ConnectionManager=Enmasse,asEvented.call(t);var u=function(n){s=n,t.trigger(t.ON_EVENT,s),s.bind(e.ON_SUBSTATE,d),d()},l=function(){if(null!==s){var t=s.getChannels();for(var n in t)t.hasOwnProperty(n)&&Enmasse.send(t[n],window.LViS.ConnectionManager.SSCP_KLASS_UNSUB);s.unbind(e.ON_SUBSTATE,d),s.destroy(),s=null}},c=function(){var n,e=new Deferred,i={},o=t.getAssets();for(var r in o)if(o.hasOwnProperty(r))for(n=0;n<o[r].length;n++){var s=o[r][n],a=s.autoload;"undefined"!=typeof a&&("undefined"==typeof i[a]&&(i[a]=[]),i[a].push(s.data))}if("undefined"!=typeof i.js&&i.js.length>0?$script(i.js,e.resolve()):e.resolve(),"undefined"!=typeof i.css&&i.css.length>0)for(n=0;n<i.css.length;n++)if(document.createStyleSheet)document.createStyleSheet(i.css[n]);else{var u=document.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("media","all"),u.setAttribute("type","text/css"),u.setAttribute("href",i.css[n]),document.head.appendChild(u)}return Deferred.when(e)},d=function(){if(null!==s){var t=s.getSubstate();switch(t){case e.STATE_ACTIVE:w();break;case e.STATE_PROLONGED:S();break;case e.STATE_FINISHED:h()}}},w=function(){var t=s.getChannels();i.setChannels(t);for(var n in t)t.hasOwnProperty(n)&&Enmasse.send(t[n],window.LViS.ConnectionManager.SSCP_KLASS_SUB)},S=function(){var t=s.getChannels();i.setChannels(t);for(var n in t)t.hasOwnProperty(n)&&Enmasse.send(t[n],window.LViS.ConnectionManager.SSCP_KLASS_SUB)},h=function(){var t=s.getChannels();for(var n in t)t.hasOwnProperty(n)&&Enmasse.send(t[n],window.LViS.ConnectionManager.SSCP_KLASS_UNSUB)},f=function(){var t=arguments[0];switch(t){case Enmasse.STATE_CONNECTED:var n=arguments[1];window.LViS.Date.setTime(n),Enmasse.send(r,window.LViS.ConnectionManager.SSCP_KLASS_SUB),d()}},E=function(){Enmasse.connect()},p=function(){t.trigger(t.ON_ERROR)},g=function(){window.LViS.Analytics.embed();var n=c(),e=window.LViS.Project.loadAppSettings(),i=window.LViS.Tracker.init({"dataset":a});Deferred.when(n,e,i).done(function(){t.trigger(t.ON_READY)}).fail(function(){t.trigger(t.ON_ERROR)})};return t.deprecate=function(t){console.warn("DEPRECATION: "+t)},t.getHost=function(){return"//"+o},t.getAssets=function(){return n.getAssets.apply(n,arguments)},t.getEvent=function(){return s},t.setEvent=function(n,e){e=e||function(){},s!==n&&n.loadHistory().always(function(){return n.isSubscribable()&&!n.isChannelsExist()?void t.trigger(t.ON_ERROR):(l(),u(n),void Deferred.when(n.ready).done(e))})},t.init=function(s){if(s=s||{},r=s.bChannel||null,o=s.host||null,a=s.dataset||null,null===r)throw"Bootstrap channel is not set";if(null===o)throw"Host is not defined";o=o.replace(/^(.*:)?(\/+)?/gi,""),e=window.LViS.Event,n=window.LViS.Listings,i=window.LViS.Factories,Enmasse.bind(Enmasse.ON_READY,E),Enmasse.bind(Enmasse.ON_ERROR,p),Enmasse.bind(Enmasse.ON_STATE,f),n.bind(n.ON_READY,g),n.init({"channel":r}),i.init(),Enmasse.init({"config":t.getHost()+"/config/enmasse.json","info":["lvis-"+t.VERSION]})},t}(window.LViS||{}),window.LViS=window.LViS||{},window.LViS.Analytics=function(){var t={};asEvented.call(t);var n="lvis",e=3e5,i=function(){t.track("send","event","system","heartbeat")};return t.getId=function(){return window.LViS.Project.get("tracking_id")},t.track=function(){if("undefined"!=typeof ga){var t=Array.prototype.slice.call(arguments);t[0]=n+"."+t[0],ga.apply(ga,t)}},t.embed=function(){var o=t.getId();null!==o&&(!function(t,n,e,i,o,r,s){t.GoogleAnalyticsObject=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},t[o].l=1*new Date,r=n.createElement(e),s=n.getElementsByTagName(e)[0],r.async=1,r.src=i,s.parentNode.insertBefore(r,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",o,"auto",{"name":n}),ga(n+".send","pageview"),setInterval(i,e))},t}(),window.LViS=window.LViS||{},window.LViS.ConnectionAdaptor=function(){var t={};asEvented.call(t);var n=1e3;t.ON_MESSAGE=Enmasse.ON_MESSAGE;var e=0,i=[],o=null,r=function(t){i.push(t),s()},s=function(){clearTimeout(o);for(var e,r=0;r<i.length;)a(i[r])?(e=i.splice(r,1)[0],h(e),t.trigger(t.ON_MESSAGE,e)):r++;i.length>0&&(o=setTimeout(s,n))},a=function(t){var n=function(){switch(t.klass){case"create":return u;case"reveal":return l;case"revoke":return c;case"stop":return d;case"p":return w;default:return S}}();return n(t)},u=function(t){var n;try{n=JSON.parse(t.body[0])}catch(i){return!1}return n.published_at+e<=window.LViS.Date.now()},l=function(t){return parseInt(t.body[2])+e<=window.LViS.Date.now()},c=function(t){var n;try{n=JSON.parse(t.body[0])}catch(i){return!1}return n.sent_at+e<=window.LViS.Date.now()},d=function(t){return parseInt(t.body[1])+e<=window.LViS.Date.now()},w=function(t){return parseInt(t.body[1])+e<=window.LViS.Date.now()},S=function(){return!0},h=function(t){var n=function(){switch(t.klass){case"snapshot":return f;case"listings":return g;case"create":return L;case"reveal":return v;case"revoke":return y;case"stop":return V;case"p":return T;default:return m}}();n(t)},f=function(t){var n;try{n=JSON.parse(t.body[0])}catch(i){}n.published_at+=e,n.published_at_iso=new Date(1e3*n.published_at).toISOString();var o=function(){switch(n.type){case"prediction":return E;default:return p}}();o(n),t.body[0]=JSON.stringify(n)},E=function(t){var n=t.data;n.start_at+=e,n.start_at_iso=new Date(1e3*n.start_at).toISOString(),n.stop_at&&(n.stop_at+=e,n.stop_at_iso=new Date(1e3*n.stop_at).toISOString()),n.reveal_answer_at&&(n.reveal_answer_at+=e,n.reveal_answer_at_iso=new Date(1e3*n.reveal_answer_at).toISOString())},p=function(){},g=function(t){var n;try{n=JSON.parse(t.body[0])}catch(e){}window.LViS.Sync.setMaxDelay(n.project.audio_sync_max_delay),window.LViS.Sync.setDefaultDelay(n.project.audio_sync_default_delay);for(var i in n.events)n.events.hasOwnProperty(i)&&_(n.events[i]);t.body[0]=JSON.stringify(n)},_=function(t){t.start_at+=e,t.start_at_iso=new Date(1e3*t.start_at).toISOString(),t.end_at+=e,t.end_at_iso=new Date(1e3*t.end_at).toISOString(),t.__delay=e},L=function(t){var n;try{n=JSON.parse(t.body[0])}catch(i){}n.published_at+=e,n.published_at_iso=new Date(1e3*n.published_at).toISOString(),t.body[0]=JSON.stringify(n)},T=function(t){t.body[1]=parseInt(t.body[1])+e},V=function(t){t.body[1]=parseInt(t.body[1])+e},v=function(t){t.body[2]=parseInt(t.body[2])+e},y=function(t){var n;try{n=JSON.parse(t.body[0])}catch(i){}n.sent_at+=e,n.sent_at_iso=new Date(1e3*n.sent_at).toISOString(),t.body[0]=JSON.stringify(n)},m=function(){return 0};return t.adaptSnapshot=function(t){return f(t)},t.adaptEvent=function(t){return _(t)},t.setDelay=function(t){e=t},t.getDelay=function(){return e},Enmasse.bind(Enmasse.ON_MESSAGE,r),t}(),window.LViS=window.LViS||{},window.LViS.Control=function(t){t=t||{};var n=this,e=t.channel,i=function(t){if(t.channel==e)switch(t.klass){case window.LViS.Control.MSG_TYPE_CREATE:o(t);break;case window.LViS.Control.MSG_TYPE_REVOKE:r(t);break;case window.LViS.Control.MSG_TYPE_EOC:s(t)}},o=function(t){var e=JSON.parse(t.body[0]),i=window.LViS.Factories.get(e.type);if("undefined"!=typeof i){var o=i.get(e.id);if(!o){try{o=i.create(e)}catch(r){console.error(r)}Deferred.when(o.finalized).done(function(){n.trigger(window.LViS.Control.MSG_TYPE_CREATE,o)})}}},r=function(t){var e=JSON.parse(t.body[0]),i=window.LViS.Factories.get(e.type);if("undefined"!=typeof i){var o=i.get(e.id);o&&(i.revoke(e.id),n.trigger(window.LViS.Control.MSG_TYPE_REVOKE,o))}},s=function(){n.trigger(window.LViS.Control.MSG_TYPE_EOC)};n.destroy=function(){window.LViS.Factories.destroyInstances(),window.LViS.ConnectionAdaptor.unbind(window.LViS.ConnectionAdaptor.ON_MESSAGE,i)},window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,i)},asEvented.call(window.LViS.Control.prototype),window.LViS.Control.MSG_TYPE_CREATE="create",window.LViS.Control.MSG_TYPE_REVOKE="revoke",window.LViS.Control.MSG_TYPE_EOC="eoc",/*!
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Tweaked by Monterosa Productions Limited 2015
 *
 **/
function(t){var n=function(t){return t.replace(/^\s+|\s+$/g,"")};t.cookie=function(t,e,i){if("undefined"==typeof e){var o=null;if(document.cookie&&""!==document.cookie)for(var r=document.cookie.split(";"),s=0;s<r.length;s++){var a=n(r[s]);if(a.substring(0,t.length+1)==t+"="){o=decodeURIComponent(a.substring(t.length+1));break}}return o}i=i||{},null===e&&(e="",i.expires=-1);var u="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var l;"number"==typeof i.expires?(l=new Date,l.setTime(l.getTime()+24*i.expires*60*60*1e3)):l=i.expires,u="; expires="+l.toUTCString()}var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",w=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),u,c,d,w].join("")}}(window.LViS||{}),window.LViS=window.LViS||{},window.LViS.Date=function(){var t={},n=.5,e=null,i=[],o=null,r=function(){return new Date/1e3},s=new Date/1e3,a=function(){clearTimeout(o);var t=r(),i=t-s;e+=i,s=t;var l=Math.floor(e)+1+n,c=1e3*(l-e);o=setTimeout(a,c),u()},u=function(){for(var t,n=[];i.length;)n.push(i.shift());for(i=[];void 0!==(t=n.shift());)t()};return t.setTime=function(t){e=Math.floor(t)+n,a()},t.now=function(){return Math.floor(e)},t.next=function(t){i.push(t)},t.setTime(r()),t}(),window.LViS=window.LViS||{},window.LViS.StorageLocalDriver=function(){var t={};return t.hasSupport=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},t.set=function(t,n){try{window.localStorage.setItem(t,n)}catch(e){e==QUOTA_EXCEEDED_ERR&&console.error("localstorage quota exceeded error")}},t.get=function(t){return window.localStorage.getItem(t)},t.remove=function(t){return window.localStorage.removeItem(t)},t}(),window.LViS.StorageCookieDriver=function(){var t={};return t.hasSupport=function(){var n="probe";try{t.set(n,n);var e=t.get(n);return t.remove(n),e===n}catch(i){return!1}},t.set=function(t,n,e){var i=[t,n];return"undefined"!=typeof e&&i.push({"expires":e}),window.LViS.cookie.apply(window.LViS.cookie,i)},t.get=function(t){return window.LViS.cookie(t)},t.remove=function(t){return window.LViS.cookie(t,null)},t}(),window.LViS.Storage=function(){for(var t=[window.LViS.StorageCookieDriver,window.LViS.StorageLocalDriver],n={},e=null,i=0;i<t.length;i++)if(t[i].hasSupport()){e=t[i];break}var o=function(){return null!==e};return n.set=function(t,n,i){return o()?e.set(t,n,i):void 0},n.get=function(t){return o()?e.get(t):void 0},n.remove=function(t){return o()?e.remove(t):void 0},n}(),window.LViS=window.LViS||{},window.LViS.Sync=function(){var t={},n=null,e=Number.POSITIVE_INFINITY,i=0;return t.setMaxDelay=function(t){t=parseInt(t),t>=0&&(e=t)},t.setDefaultDelay=function(t){t=parseInt(t),t>=0&&(i=t),i>e&&(i=e),null===n&&window.LViS.ConnectionAdaptor.setDelay(i)},t.setDelay=function(t){t=parseInt(t),n=0>t?0:t>e?e:t,window.LViS.ConnectionAdaptor.setDelay(n)},t.getMaxDelay=function(){return e},t.getDelay=function(){return window.LViS.ConnectionAdaptor.getDelay()},t}(),window.LViS=window.LViS||{},window.LViS.User=function(){var t={};t.ON_INTERACTION_SUBMIT="submit",t.ON_INTERACTION_REVEAL="reveal",asEvented.call(t);var n=t.bind,e=null,i=function(t){e=t,t.bind(window.LViS.Event.ON_ELEMENT_CREATE,l)},o=function(t){e=null,t.unbind(window.LViS.Event.ON_ELEMENT_CREATE,l)},r=function(t,n){var i=null,o=null;switch(t.constructor){case window.LViS.Poll:i="poll",o=e.getChannels(window.LViS.CHANNEL_POLL);break;case window.LViS.Quiz:i="quiz",o=e.getChannels(window.LViS.CHANNEL_POLL)}return{"session_id":window.LViS.ConnectionManager.getSessionId(),"element_id":t.getEnmasseId(),"element_type":i,"interaction_type":n,"option_id":t.getUserVote(),"channel_id":o}},s=function(t){null!==e&&o(e),i(t)},a=function(n){var e=r(n,"submit");t.trigger(t.ON_INTERACTION_SUBMIT,n,e)},u=function(n,e){if(e===window.LViS.Quiz.STATE_REVEALED){var i=n.getUserSubmission();if(null!==i){var o=i.isCorrect?"correct":"incorrect",s=r(n,o);t.trigger(t.ON_INTERACTION_REVEAL,n,s)}}},l=function(t){switch(t.constructor){case window.LViS.CombiPoll:case window.LViS.Powerbar:case window.LViS.Poll:t.bind(window.LViS.Poll.ON_VOTE,function(){a(t)});break;case window.LViS.Quiz:t.bind(window.LViS.Quiz.ON_VOTE,function(){a(t)}),t.bind(window.LViS.Quiz.ON_STATE_CHANGE,function(n){u(t,n)})}};return t.getSessionId=function(){return window.LViS.ConnectionManager.getSessionId()},t.signIn=function(t,n,e){return window.LViS.ConnectionManager.signIn(t,n,e)},t.bind=function(){var e=null;switch(arguments[0]){case t.ON_INTERACTION_SUBMIT:e="LViS.User.ON_INTERACTION_SUBMIT";break;case t.ON_INTERACTION_REVEAL:e="LViS.User.ON_INTERACTION_REVEAL"}null!==e&&window.LViS.deprecate("Event "+e+" has been deprecated. Please implement user votes storage in the application layer"),n.apply(t,arguments)},window.LViS.bind(window.LViS.ON_EVENT,s),t}(),window.LViS.Tracker=function(){var t={},n={"squad":[],"tracking":[]},e=1,i="//s3-eu-west-1.amazonaws.com/ibcstats";asEvented.call(t);var o=function(){return i+"/tracking-"+e+".json"},r=function(t){t.squad[2]={"players":[{"jersey":90,"fn":"","ln":""},{"jersey":92,"fn":"","ln":""}],"team":2};for(var e=0,i=t.tracking.length;i>e;e++)t.tracking[e].duration=t.tracking[e].timecode-(t.tracking[e-1]?t.tracking[e-1].timecode:0);n=t};return t.timecodeToIndex=function(t){var e=n.tracking.length,i=n.tracking[e-1],o=Math.floor(e*t/i.timecode);return o>e&&(o=e),o},t.getSquad=function(){return n.squad},t.getTrack=function(t){return n.tracking[t]},t.init=function(t){return t=t||{},t.dataset&&(e=t.dataset),$.getJSON(o()).done(r)},t}(),window.LViS=window.LViS||{},window.LViS.Project=function(){var t={},n={},e={};return t.get=function(t){return"undefined"==typeof t?n:"undefined"!=typeof n[t]?n[t]:null},t.getSettings=function(t){return"undefined"==typeof t?e:"undefined"!=typeof e[t]?e[t]:null},t.getUUID=function(){return t.get("uuid")},t.setData=function(t){n=t||{}},t.getSkinUrl=function(){return t.get("app_skin")},t.loadAppSettings=function(){var n=t.get("app_settings"),i=new Deferred,o=function(t){e=t,i.resolve()},r=function(){i.reject()};return null!==n?i=JSONP({"url":n,"dataType":"jsonp","callback":"__lvis_app_settings_callback","callbackParameter":"__lvis_app_settings_callback","success":o,"error":r}):i.resolve(),i.promise()},t}(),window.LViS=window.LViS||{},window.LViS.Listings=function(){var t={},n=null,e=[],i={},o={},r=!1;t.ON_READY="ready",t.ON_UPDATE="update",t.MSG_CLASS="listings",asEvented.call(t);var s=function(s){if(s.channel==n)switch(s.klass){case t.MSG_CLASS:var a=JSON.parse(s.body[0]),l=r&&u(a);e=a.events,e.sort(function(t,n){return t.start_at<n.start_at?-1:t.start_at>n.start_at?1:0}),window.LViS.Project.setData(a.project),r||(i=a.assets);for(var c=0,d=e.length;d>c;c++){var w=e[c];o[w.id]&&o[w.id].setData(w)}l&&t.trigger(t.ON_UPDATE);break;case window.LViS.ConnectionManager.SSCP_KLASS_EOC:r||(r=!0,t.trigger(t.ON_READY))}},a=function(t,n){for(var e=0,i=t.length;i>e;e++)if(t[e].id===n)return t[e];return null},u=function(t){var n,i,o;for(n=0,i=t.events.length;i>n;n++)if(o=a(e,t.events[n].id),null===o||o.digest!=t.events[n].digest)return!0;for(n=0,i=e.length;i>n;n++)if(null===a(t.events,e[n].id))return!0;return!1};return t.get=function(t){if("undefined"!=typeof o[t])return o[t];var n=a(e,t),i=new window.LViS.Event(t);return n&&i.setData(n),o[t]=i,i},t.getCurrent=function(){for(var n=[],i=window.LViS.Date.now(),o=0,r=e.length;r>o;o++)e[o].start_at<i&&i<e[o].end_at&&n.push(t.get(e[o].id));return n.length?n:null},t.getNext=function(){var n,i,o=Number.POSITIVE_INFINITY,r=[],s=window.LViS.Date.now();for(n=0,i=e.length;i>n;n++)s<e[n].start_at&&e[n].start_at<o&&(o=e[n].start_at);if(o<Number.POSITIVE_INFINITY)for(n=0,i=e.length;i>n;n++)e[n].start_at==o&&r.push(t.get(e[n].id));return r.length?r:null},t.getList=function(){for(var t,n=[],i=0,o=e.length;o>i;i++)null!==(t=this.get(e[i].id))&&n.push(t);return n},t.getAssets=function(t){return"undefined"==typeof t?i:i[t]||null},t.init=function(t){t=t||{},n=t.channel||null,window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,s)},t}(),window.LViS=window.LViS||{},window.LViS.Event=function(t){t=t||null;var n=window.LViS.Event,e=window.LViS.Control,i=window.LViS.Factories,o=window.LViS.Tracker,r=this,s=n.STATE_PENDING,a={},u=[],l=null,c=null,d=null,w=null;r.ready=new Deferred;var S=function(){h(),f(),l=setInterval(f,1e3)},h=function(){clearInterval(l)},f=function(){var t,e=window.LViS.Date.now(),i=r.get("end_at"),o=r.get("start_at"),a=r.get("__delay"),u=parseInt(window.LViS.Project.get("event_extra_time"),10)||0;!r.get("started")||o>e?t=n.STATE_UPCOMING:i>e?t=n.STATE_ACTIVE:i-a+u>e?t=n.STATE_PROLONGED:(t=n.STATE_FINISHED,h()),t!=s&&T(t)},E=function(){null===w&&(w=new e({"channel":r.getChannels(window.LViS.CHANNEL_CONTROL)}),w.bind(e.MSG_TYPE_CREATE,A),w.bind(e.MSG_TYPE_REVOKE,O),w.bind(e.MSG_TYPE_EOC,N))},p=function(){null!==w&&(w.unbind(e.MSG_TYPE_CREATE,A),w.unbind(e.MSG_TYPE_REVOKE,O),w.unbind(e.MSG_TYPE_EOC,N),w.destroy(),w=null)},g=function(){L()},_=function(){c=null,clearTimeout(d)},L=function(){var t=1e3*(window.LViS.Date.now()-r.get("start_at"));null===c&&(c=o.timecodeToIndex(t));var e=o.getTrack(c);return e?(d=setTimeout(L,e.duration),c++,void r.trigger(n.ON_TRACK,e)):_()},T=function(t){switch(s=t){case n.STATE_FAILURE:case n.STATE_UPCOMING:case n.STATE_FINISHED:_(),r.ready.resolve();break;case n.STATE_ACTIVE:case n.STATE_PROLONGED:g(),E()}r.trigger(n.ON_STATE,r.getState()),r.trigger(n.ON_SUBSTATE,r.getSubstate())},V=function(t){for(var n=0,e=t.timeline.length;e>n;n++){var o=t.timeline[n],s=i.get(o.type),u={"channel":null,"klass":"snapshot","body":[JSON.stringify(o)]};window.LViS.ConnectionAdaptor.adaptSnapshot(u),o=JSON.parse(u.body[0]);try{var l=s.createSnapshot(o);A(l)}catch(c){console.error(c)}}r.isPending()&&(window.LViS.ConnectionAdaptor.adaptEvent(t.config),a=t.config,S())},v=function(t){for(var n=u.length;n--;)if(u[n].getId()===t.getId())return!0;return!1},y=function(t){var n=u.indexOf(t);n>-1&&u.splice(n,1)},m=function(t){if(!v(t)){for(var n=u.length-1;n>=0;n--){if(u[n].publishedAt<t.publishedAt)return void u.splice(n+1,0,t);if(u[n].publishedAt==t.publishedAt&&u[n].id<t.id)return void u.splice(n+1,0,t)}u.unshift(t)}},A=function(t){m(t),"resolved"==r.ready.state()&&r.trigger(n.ON_ELEMENT_CREATE,t)},O=function(t){y(t),r.trigger(n.ON_ELEMENT_REVOKE,t)},N=function(){r.ready.resolve()};this.get=function(t){return"undefined"==typeof t?a:"undefined"!=typeof a[t]?a[t]:null},this.getUUID=function(){return t},this.getChannels=function(t){var n=this.getUUID(),e=function(t){return t+"-"+n};if("undefined"==typeof t)return{"poll":e(window.LViS.CHANNEL_POLL),"control":e(window.LViS.CHANNEL_CONTROL)};if(t===window.LViS.CHANNEL_POLL||t===window.LViS.CHANNEL_CONTROL)return e(t);throw"Unknown channel type "+t},this.getSquad=function(){return o.getSquad()},this.getImageUrl=function(){return this.get("image_url")},this.getName=function(){return this.get("name")},this.getStartAt=function(){return this.get("start_at")},this.getEndAt=function(){return this.get("end_at")},this.getState=function(){switch(s){case n.STATE_PROLONGED:return n.STATE_FINISHED;default:return s}},this.getSubstate=function(){return s},this.getCustomFields=function(t){var n=this.get("custom_fields");return"undefined"==typeof t?n:"undefined"!=typeof n[t]?n[t]:null},this.getCountdown=function(t){t=t||window.LViS.TIME_FORMAT_SECONDS;var n={"years":0,"months":0,"days":0,"hours":0,"minutes":0,"seconds":0},e=this.get("start_at")-window.LViS.Date.now();if(0>e&&(e=0),t==window.LViS.TIME_FORMAT_SECONDS)return e;var i,o,r=new Date(1e3*e),s={"years":"getUTCFullYear","months":"getUTCMonth","days":"getUTCDate","hours":"getUTCHours","minutes":"getUTCMinutes","seconds":"getUTCSeconds"};for(var a in n)if(n.hasOwnProperty(a)){switch(i=s[a],o=r[i](),i){case"getUTCDate":o--;break;case"getUTCFullYear":o-=1970}n[a]=o}switch(t){case window.LViS.TIME_FORMAT_OBJECT:return n;case window.LViS.TIME_FORMAT_ARRAY:var u=n;return[u.seconds,u.minutes,u.hours,u.days,u.months,u.years];default:return null}},this.getHistory=function(){return u},this.getLastFromHistory=function(){var t=null;return u.length>0&&(t=u[u.length-1]),t},this.setData=function(t){a&&a.digest?a.digest!=t.digest&&(a=t||{},f(),r.trigger(n.ON_UPDATE)):(a=t||{},S())},this.isPending=function(){return s===n.STATE_PENDING},this.isChannelsExist=function(){var t=this.getChannels();return"undefined"!=typeof t&&"undefined"!=typeof t.control&&"undefined"!=typeof t.poll},this.isSubscribable=function(){return s===n.STATE_ACTIVE||s===n.STATE_PROLONGED||s===n.STATE_FINISHED},this.increaseTrackingIndex=function(){null!==c&&c++},this.decreaseTrackingIndex=function(){null!==c&&c--},this.loadHistory=function(){var e=new Deferred,i=parseInt(window.LViS.Project.get("history_ignore"),10)||60,o=this.get("__delay"),s=this.get("start_at"),a=s-o+i,u=function(t){try{V(t)}catch(n){throw n}},l=function(){r.isPending()&&T(n.STATE_FAILURE)};return this.isPending()||window.LViS.Date.now()>a?e=JSONP({"url":window.LViS.getHost()+"/events/"+t.substr(0,2)+"/"+t+"/history.jsonp","dataType":"jsonp","callback":"__lvis_history_callback","callbackParameter":"__lvis_history_callback","success":u,"error":l}):e.resolve(),e},this.destroy=function(){h(),p()}},asEvented.call(window.LViS.Event.prototype),window.LViS.Event.ON_UPDATE="update",window.LViS.Event.ON_STATE="state",window.LViS.Event.ON_SUBSTATE="substate",window.LViS.Event.ON_ELEMENT_CREATE="create",window.LViS.Event.ON_ELEMENT_REVOKE="revoke",window.LViS.Event.ON_TRACK="track",window.LViS.Event.STATE_FAILURE="failure",window.LViS.Event.STATE_PENDING="pending",window.LViS.Event.STATE_UPCOMING="upcoming",window.LViS.Event.STATE_ACTIVE="active",window.LViS.Event.STATE_PROLONGED="prolonged",window.LViS.Event.STATE_FINISHED="finished",window.LViS.Fadeable={"getFade":function(){return this.fade},"init":function(t){this._super.apply(this,arguments),this.fade=t.data.fade}},window.LViS.Revealable={"hasResults":function(){return null!==this.results&&this.isResultsRevealed()},"isResultsRevealed":function(){switch(this.revealResultsMode){case window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE:return this.hasUserVoted()||this.isClosed();case window.LViS.Revealable.REVEAL_RESULTS_ON_CLOSE:return this.isClosed();case window.LViS.Revealable.REVEAL_RESULTS_ON_EVENT_END:case window.LViS.Revealable.REVEAL_RESULTS_MANUALLY:return null!==this.results;case window.LViS.Revealable.REVEAL_RESULTS_NEVER:return!1}},"init":function(t){this._super.apply(this,arguments),this.revealResultsMode=t.data.reveal_results_mode||window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE}},window.LViS.Revealable.REVEAL_RESULTS_ON_VOTE="vote",window.LViS.Revealable.REVEAL_RESULTS_ON_CLOSE="close",window.LViS.Revealable.REVEAL_RESULTS_ON_EVENT_END="event_end",window.LViS.Revealable.REVEAL_RESULTS_MANUALLY="manual",window.LViS.Revealable.REVEAL_RESULTS_NEVER="never",window.LViS.Entity=Class.extend({"getId":function(){return this.id},"getEnmasseId":function(){return this.enmasseId},"getPublishedAt":function(){return this.publishedAt},"finalize":function(){this.finalized.resolve()},"destroy":function(){},"init":function(t){asEvented.call(this),t=t||{},this.id=t.id-0||0,this.enmasseId=t.data.id-0||0,this.publishedAt=t.published_at-0||0,this.finalized=new Deferred}}),window.LViS.Frame=window.LViS.Entity.extend({"getEnmasseId":function(){return this.enmasseId},"getDuration":function(){return this.duration},"getDurationLeft":function(){return this.durationLeft},"getType":function(){return this.type},"getContentType":function(){return null===this.contentType?this.type:this.contentType},"getCustomFields":function(t){return"undefined"==typeof t?this.customFields:"undefined"!=typeof this.customFields[t]?this.customFields[t]:null},"getUserSubmission":function(){return window.LViS.deprecate("Elements' getUserSubmission() method has been deprecated. Please implement user votes storage in the application layer"),null},"hasFixedDuration":function(){return this.fixed},"setDuration":function(t){this.duration=parseInt(t,10)},"setDurationLeft":function(t){this.durationLeft=parseInt(t,10)},"abort":function(){this.aborted=!0,this.setDurationLeft(0)},"updateDurationLeft":function(){if(!this.aborted){var t=this,n=this.publishedAt+this.duration,e=window.LViS.Date.now(),i=n-e;this.setDurationLeft(i),this.durationLeft>0?window.LViS.Date.next(function(){t.updateDurationLeft()}):this.durationLeft=0}},"init":function(t){this._super(t),t=t||{},this.aborted=!1,this.enmasseId=t.data.id,this.duration=t.duration-0||0,this.durationLeft=0,this.type=t.type,this.fixed=t.fixed,this.contentType=t.content_type||null,this.customFields=t.custom_fields||{},this.fixed&&this.updateDurationLeft()}}),window.LViS.Poll=window.LViS.Frame.extend({"getQuestion":function(){return this.question},"getOptions":function(){return this.options},"getResults":function(){return this.results},"getState":function(){return this.state},"getUserVote":function(){return this.votedFor},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"optionId":this.votedFor}},"hasUserVoted":function(){return null!==this.getUserVote()},"hasResults":function(){return null!==this.results},"vote":function(t){this.votedFor=t,this.storeVote(),this.triggerVote()},"setState":function(t){void 0!==t&&t!=this.state&&(this.state=t,this.trigger(window.LViS.Poll.ON_STATE_CHANGE,t))},"setResults":function(t){JSON.stringify(t)!=JSON.stringify(this.rawResults)&&(this.rawResults=t,this.populateResults(t),this.hasResults()&&this.trigger(window.LViS.Poll.ON_RESULTS))},"isStarted":function(){return this.state===window.LViS.Poll.STATE_STARTED},"isClosed":function(){return this.state===window.LViS.Poll.STATE_CLOSED},"stop":function(){this.abort(),this.setState(window.LViS.Poll.STATE_CLOSED)},"populateResults":function(t){t=t||[],this.results=[];for(var n=0,e=this.options.length;e>n;n++)this.results[n]={"votes":t[n]||0,"percent":0};this.calculatePercentage(this.results)},"calculatePercentage":function(t){var n,e,i=0,o=0,r=0;for(n=t.length;n--;)i+=parseInt(t[n].votes,10);for(n=0,e=t.length;e>n;n++)r=t[n].votes/i*100||0,t[n]={"votes":t[n].votes,"percent":Math.round(o+r)-Math.round(o)},o+=r;return t},"storeVote":function(){var t="frame_"+this.getId(),n=JSON.stringify(this.votedFor),e=new Date(1e3*(window.LViS.Date.now()+window.LViS.Poll.EXPIRE));window.LViS.Storage.set(t,n,e)},"recoverVote":function(){var t="frame_"+this.getId();try{this.votedFor=JSON.parse(window.LViS.Storage.get(t))}catch(n){console.error("Unable to recover option user voted for",n)}},"triggerVote":function(){this.trigger(window.LViS.Poll.ON_VOTE,this.votedFor)},"init":function(t){if(this._super(t),this.question=t.data.question,this.options=t.data.options,this.rawResults=null,this.results=null,this.votedFor=null,this.state=t.data.state||window.LViS.Poll.STATE_STARTED,this.recoverVote(),t.data.hasOwnProperty("results")){var n=t.data.results.map(function(t){return t.votes});this.setResults(n)}}}),window.LViS.Poll.TYPE="rpoll",window.LViS.Poll.EXPIRE=604800,window.LViS.Poll.STATE_STARTED="started",window.LViS.Poll.STATE_CLOSED="stopped",window.LViS.Poll.ON_VOTE="voted",window.LViS.Poll.ON_RESULTS="results",window.LViS.Poll.ON_STATE_CHANGE="state",window.LViS.Regular=window.LViS.Poll.extend(window.LViS.Revealable).extend({"getQualifyingHashtags":function(){return this.qualifying_hashtags},"init":function(t){this._super.apply(this,arguments),this.qualifying_hashtags=t.data.qualifying_hashtags}}),window.LViS.Regular.TYPE="rpoll",window.LViS.Regular.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Regular.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Regular.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Regular.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Regular.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.CombiPoll=window.LViS.Poll.extend(window.LViS.Revealable).extend({"getQuestion":function(t){return"undefined"==typeof t?this.question:this.question[t]},"getOptions":function(t){return"undefined"==typeof t?this.options:this.options[t]},"getResults":function(t){return 0===t?this.getFirstQuestionResult():this.results},"getFirstQuestionResult":function(){var t,n,e,i,o=[];for(t=0,e=this.results.length;e>t;t++)for(n=0,i=this.results[t].length;i>n;n++)"undefined"==typeof o[n]&&(o[n]={"votes":0,"percent":0}),o[n].votes+=this.results[t][n].votes;return this.calculatePercentage(o),o},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:this.votedFor},"vote":function(t,n){null===this.votedFor&&(this.votedFor=[]),this.votedFor[t]=n,this.storeVote(),this.triggerVote()},"hasUserVoted":function(t){return"undefined"==typeof t?this.hasUserVoted(0)&&this.hasUserVoted(1):null===this.votedFor?!1:"undefined"!=typeof this.votedFor[t]},"setEmptyResults":function(){var t=function(n,e){"undefined"==typeof e&&(e=n.length-1);for(var i=[],o=0,r=n[e].length+e;r>o;o++)i[o]=0===e?{"votes":0,"percent":0}:t(n,e-1);return i};this.results=t(this.options)},"populateResults":function(t){var n=this;this.setEmptyResults();var e=0,i=function(n){for(var o=0;o<n.length;o++)n[o].constructor===Array?i(n[o]):(n[o].votes=t[e]?t[e]:0,e++)},o=function(t){var e,i;if(t[0].constructor!==Array)n.calculatePercentage(t);else for(e=0,i=t.length;i>e;e++)o(t[e])};i(this.results),o(this.results)},"init":function(t){t.data.hasOwnProperty("results")&&(t.data.results=t.data.results.reduce(function(t,n){return t.concat(n)})),this._super(t)}}),window.LViS.CombiPoll.TYPE="cpoll",window.LViS.CombiPoll.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.CombiPoll.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.CombiPoll.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.CombiPoll.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.CombiPoll.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Powerbar=window.LViS.Poll.extend(window.LViS.Fadeable).extend({"setResults":function(t){for(var n={"time":window.LViS.Date.now(),"volume":0,"average":0,"responses":0},e=0,i=9;i>=e;e++)"undefined"!=typeof t[e]&&(n.volume+=t[e]*(e+1),n.responses+=t[e]);0!==n.responses&&(n.average=Math.round(n.volume/n.responses)),this.results.push(n),this.trigger(window.LViS.Powerbar.ON_RESULTS,n)},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"strength":this.votedFor}},"hasResults":function(){return this.results.length>0},"init":function(){this._super.apply(this,arguments),this.options=this.options.map(function(t,n){return{"text":"Strength "+(n+1)}}),this.results=[]}}),window.LViS.Powerbar.TYPE="powerbar",window.LViS.Powerbar.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Powerbar.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Powerbar.ON_VOLUME_UPDATE="volume",window.LViS.Powerbar.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Powerbar.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Powerbar.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Diametric=window.LViS.Poll.extend({"getUserVote":function(){return null===this.votedFor?null:Math.floor(this.votedFor/window.LViS.Diametric.MAX_STRENGTH)},"getUserVoteStrength":function(){return null===this.votedFor?null:this.votedFor%window.LViS.Diametric.MAX_STRENGTH+1},"getUserSubmission":function(){return this._super.apply(this,arguments),null===this.votedFor?null:{"optionId":this.getUserVote(),"strength":this.getUserVoteStrength()}},"setResults":function(t){for(var n=window.LViS.Diametric.MAX_STRENGTH,e=[0,0],i=0;n>i;i++)t[i]&&(e[0]+=(i+1)*t[i]),t[i+n]&&(e[1]+=(i+1)*t[i+n]);this._super(e)},"vote":function(t,n){var e=window.LViS.Diametric.MIN_STRENGTH,i=window.LViS.Diametric.MAX_STRENGTH;if("undefined"==typeof t)return console.warn("Vote option is not set");if("undefined"==typeof n)return console.warn("Vote strength is not set");if(e>n)return console.warn("Can't vote for the option %s with strength %s that is less than minimum allowed strength %s",t,n,e);if(n>i)return console.warn("Can't vote for the option %s with strength %s that is more than maximum allowed strength %s",t,n,i);if(0>t||t>this.options.length-1)return console.warn("Can't vote for inexistent option with idx %s",t);var o=t*i+n-1;this._super(o)},"isResultsRevealed":function(){return!0}}),window.LViS.Diametric.MIN_STRENGTH=1,window.LViS.Diametric.MAX_STRENGTH=5,window.LViS.Diametric.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Diametric.STATE_CLOSED=window.LViS.Poll.STATE_CLOSED,window.LViS.Swing=window.LViS.Diametric.extend({}),window.LViS.Swing.TYPE="dpoll",window.LViS.Swing.STATE_STARTED=window.LViS.Diametric.STATE_STARTED,window.LViS.Swing.STATE_CLOSED=window.LViS.Diametric.STATE_CLOSED,window.LViS.Emoting=window.LViS.Diametric.extend(window.LViS.Fadeable).extend({}),window.LViS.Emoting.TYPE="emo",window.LViS.Emoting.STATE_STARTED=window.LViS.Diametric.STATE_STARTED,window.LViS.Emoting.STATE_CLOSED=window.LViS.Diametric.STATE_CLOSED,window.LViS.Quiz=window.LViS.Poll.extend(window.LViS.Revealable).extend({"isClosed":function(){return this.isStopped()||this.isRevealed()},"isStopped":function(){return this.state===window.LViS.Quiz.STATE_STOPPED},"isRevealed":function(){return this.state===window.LViS.Quiz.STATE_REVEALED},"reveal":function(t){this.correctOption=t,this.setState(window.LViS.Quiz.STATE_REVEALED)},"stop":function(){this.abort(),this.setState(window.LViS.Quiz.STATE_STOPPED)},"getCorrectOption":function(){return this.correctOption},"getUserSubmission":function(){this._super.apply(this,arguments);var t={};return null===this.votedFor?null:(t.optionId=this.votedFor,null!==this.correctOption&&(t.isCorrect=this.votedFor==this.correctOption),t)},"init":function(t){this._super.apply(this,arguments),this.correctOption=t.data.hasOwnProperty("correct_option")?t.data.correct_option-1:null}}),window.LViS.Quiz.ON_VOTE=window.LViS.Poll.ON_VOTE,window.LViS.Quiz.ON_STATE_CHANGE=window.LViS.Poll.ON_STATE_CHANGE,window.LViS.Quiz.ON_RESULTS=window.LViS.Poll.ON_RESULTS,window.LViS.Quiz.STATE_STARTED=window.LViS.Poll.STATE_STARTED,window.LViS.Quiz.STATE_STOPPED=window.LViS.Poll.STATE_CLOSED,window.LViS.Quiz.STATE_REVEALED="revealed",window.LViS.Trivia=window.LViS.Quiz.extend({}),window.LViS.Trivia.TYPE="trivia",window.LViS.Trivia.STATE_STARTED=window.LViS.Quiz.STATE_STARTED,window.LViS.Trivia.STATE_STOPPED=window.LViS.Quiz.STATE_STOPPED,window.LViS.Trivia.STATE_REVEALED=window.LViS.Quiz.STATE_REVEALED,window.LViS.Trivia.ON_VOTE=window.LViS.Quiz.ON_VOTE,window.LViS.Trivia.ON_STATE_CHANGE=window.LViS.Quiz.ON_STATE_CHANGE,window.LViS.Trivia.ON_RESULTS=window.LViS.Quiz.ON_RESULTS,window.LViS.Prediction=window.LViS.Quiz.extend({}),window.LViS.Prediction.TYPE="prediction",window.LViS.Prediction.STATE_STARTED=window.LViS.Quiz.STATE_STARTED,window.LViS.Prediction.STATE_STOPPED=window.LViS.Quiz.STATE_STOPPED,window.LViS.Prediction.STATE_REVEALED=window.LViS.Quiz.STATE_REVEALED,window.LViS.Prediction.ON_VOTE=window.LViS.Quiz.ON_VOTE,window.LViS.Prediction.ON_STATE_CHANGE=window.LViS.Quiz.ON_STATE_CHANGE,window.LViS.Prediction.ON_RESULTS=window.LViS.Quiz.ON_RESULTS,window.LViS.Data=window.LViS.Frame.extend({"getState":function(){return this.state},"setState":function(t){t!=this.state&&(this.state=t,this.trigger(window.LViS.Data.ON_STATE_CHANGE,t))},"updateDurationLeft":function(){this._super(),this.setState(this.durationLeft>0?window.LViS.Data.STATE_STARTED:window.LViS.Data.STATE_CLOSED)},"init":function(t){this._super(t),this.state=null}}),window.LViS.Data.TYPE="data",window.LViS.Data.STATE_STARTED=1,window.LViS.Data.STATE_CLOSED=2,window.LViS.Data.ON_STATE_CHANGE="state",window.LViS=window.LViS||{},window.LViS.Curation=window.LViS.Entity.extend({"getText":function(){return this.text},"getSender":function(){return this.sender},"getSenderName":function(){return this.senderName},"getSenderPicure":function(){return this.senderPicture},"getSource":function(){return this.source},"init":function(t){this._super(t),this.text=t.data.text,this.sender=t.data.sender,this.senderName=t.data.sender_name,this.senderPicture=t.data.sender_picture,this.source=t.data.source}}),window.LViS.Curation.TYPE="curation",window.LViS.Curation.SOURCE_TWITTER="twitter",window.LViS.BaseFactory=Class.extend({"get":function(t){return this.instances[t]||!1},"create":function(){},"createSnapshot":function(){},"revoke":function(t){this.instances.hasOwnProperty(t)&&delete this.instances[t]},"destroyInstances":function(){for(var t in this.instances)this.instances.hasOwnProperty(t)&&(this.instances[t].destroy(),delete this.instances[t])},"init":function(){asEvented.call(this),this.instances={}}}),window.LViS.FrameFactory=window.LViS.BaseFactory.extend({"getByEnmasseId":function(t){for(var n in this.instances)if(this.instances[n].getEnmasseId()==t)return this.instances[n];return!1},"setMessages":function(){}}),window.LViS.PollFactory=window.LViS.FrameFactory.extend({"messages":[],"vote":function(t,n){var e=this.getByEnmasseId(t),i=[t,n+1];window.LViS.ConnectionManager.send(e._channel,"v",i)},"processMessages":function(){for(var t,n=0;n<this.messages.length;){t=this.messages[n];var e=this.getByEnmasseId(t.body[0]);if(e)switch(this.instances[e.getId()]._channel=t.channel,this.messages.splice(n,1),t.klass){case window.LViS.PollFactory.MSG_CLASS_POLL:this.processPollMessage(e,t);break;case window.LViS.PollFactory.MSG_CLASS_FB:this.processFeedbackMessage(e,t);break;case window.LViS.PollFactory.MSG_CLASS_STOP:this.processStopMessage(e,t);break;case window.LViS.PollFactory.MSG_CLASS_REVEAL:this.processRevealMessage(e,t)}else n++}},"processPollMessage":function(t){t.finalize()},"processFeedbackMessage":function(t,n){var e,i,o=n.body[1].split(":"),r="fin"===n.body[2],s=[];if(o.length>1)for(var a=0,u=o.length/2;u>a;a++)e=+o[2*a]-1,i=+o[2*a+1],s[e]=i;(s.length>0||r)&&t.setResults(s)},"processStopMessage":function(t){t.stop()},"processRevealMessage":function(t,n){t.reveal(n.body[1]-1)},"create":function(t){this._super(t);var n=this.getConstructorByType(t.type),e=new n(t);return this.instances[t.id]=e,this.processMessages(),e.bind(window.LViS.Poll.ON_VOTE,this.handleVote.bind(this,e)),e},"createSnapshot":function(t){this._super(t);var n=this.getConstructorByType(t.type),e=new n(t);return this.instances[t.id]=e,e.finalize(),e},"setMessage":function(t){-1!==window.LViS.PollFactory.MSG_CLASSES.indexOf(t.klass)&&(this.messages.push(t),this.processMessages())},"getConstructorByType":function(t){switch(t){case window.LViS.CombiPoll.TYPE:return window.LViS.CombiPoll;case window.LViS.Powerbar.TYPE:return window.LViS.Powerbar;case window.LViS.Prediction.TYPE:return window.LViS.Prediction;case window.LViS.Trivia.TYPE:return window.LViS.Trivia;case window.LViS.Swing.TYPE:return window.LViS.Swing;case window.LViS.Emoting.TYPE:return window.LViS.Emoting;case window.LViS.Regular.TYPE:return window.LViS.Regular}},"handleVote":function(t,n){var e=0;switch(t.getType()){case window.LViS.CombiPoll.TYPE:for(var i=t.getOptions(),o=1,r=0,s=n.length;s>r;r++)e+=o*(n[r]+1),o*=i[r].length;e-=1;break;default:e=n}this.vote(t.getEnmasseId(),e)},"init":function(){this._super();for(var t=[window.LViS.Regular.TYPE,window.LViS.CombiPoll.TYPE,window.LViS.Powerbar.TYPE,window.LViS.Swing.TYPE,window.LViS.Emoting.TYPE,window.LViS.Prediction.TYPE,window.LViS.Trivia.TYPE],n=t.length;n--;)window.LViS.Factories.register(t[n],this)}}),window.LViS.PollFactory.MSG_CLASS_POLL="p",window.LViS.PollFactory.MSG_CLASS_FB="fb",window.LViS.PollFactory.MSG_CLASS_STOP="stop",window.LViS.PollFactory.MSG_CLASS_REVEAL="reveal",window.LViS.PollFactory.MSG_CLASSES=[window.LViS.PollFactory.MSG_CLASS_POLL,window.LViS.PollFactory.MSG_CLASS_FB,window.LViS.PollFactory.MSG_CLASS_STOP,window.LViS.PollFactory.MSG_CLASS_REVEAL],window.LViS.DataFactory=window.LViS.FrameFactory.extend({"create":function(t){this._super(t);var n=new window.LViS.Data(t);return n.finalize(),this.instances[t.id]=n,n},"createSnapshot":function(t){return this._super(t),this.create(t)},"init":function(){this._super(),window.LViS.Factories.register(window.LViS.Data.TYPE,this)
}}),window.LViS.CurationFactory=window.LViS.BaseFactory.extend({"create":function(t){this._super(t);var n=new window.LViS.Curation(t);return this.instances[t.id]=n,n},"createSnapshot":function(t){return this._super(t),this.create(t)},"init":function(){this._super(),window.LViS.Factories.register(window.LViS.Curation.TYPE,this)}}),window.LViS=window.LViS||{},window.LViS.Factories=function(){var t={},n={},e=[],i={};t.items={};var o=function(t){var n;return null!==(n=r(t.channel))&&n.setMessage(t),null},r=function(t){for(var e in n)if(n.hasOwnProperty(e)&&n[e]==t)return i[e]||null;return null};return t.destroyInstances=function(){for(var t=e.length;t--;)e[t].destroyInstances()},t.setChannels=function(t){n=t},t.register=function(t,n){"undefined"==typeof this.items[t]&&(this.items[t]=n)},t.get=function(t){return this.items[t]},t.init=function(){for(var t,n=[{"obj":window.LViS.PollFactory,"channel":"poll"},{"obj":window.LViS.DataFactory,"channel":null},{"obj":window.LViS.CurationFactory,"channel":null}],r=n.length;r--;)t=new n[r].obj,e.push(t),null!==n[r].channel&&(i[n[r].channel]=t);window.LViS.ConnectionAdaptor.bind(window.LViS.ConnectionAdaptor.ON_MESSAGE,o)},t}(),window.LViS=window.LViS||{},window.LViS.Demographics=function(){var t={};return t.ERROR_NO_EVENT=1,t.ERROR_SEGMENT=2,t.ERROR_COUNTER=3,t.addCounter=function(n,e,i,o,r){i="undefined"!=typeof i?i:null,o="undefined"!=typeof o?o:null,r="undefined"!=typeof r?r:null;var s=window.LViS.getEvent();if(!s)throw t.ERROR_NO_EVENT;if(n.constructor!==Array||!n.length||n.length%2!==0)throw t.ERROR_SEGMENT;if(e!==parseInt(e,10))throw t.ERROR_COUNTER;for(var a=[],u=[],l=0,c=n.length/2;c>l;l++)a.push(n[2*l]),u.push(n[2*l+1]);window.LViS.ConnectionManager.send(s.getChannels(window.LViS.CHANNEL_CONTROL),"avgcounter",[s.getUUID(),o,r,i,a.join(":"),u.join(":"),e])},t}();